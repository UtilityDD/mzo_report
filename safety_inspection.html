<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safety Inspection Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px;
        }

        .header {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            padding: 24px 16px;
            margin: -16px -16px 24px -16px;
            border-radius: 0 0 16px 16px;
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }

        .header h1 {
            font-size: 24px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .header .updated-on {
            opacity: 0.8;
            font-size: 12px;
            font-style: italic;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
            border-color: #2196F3;
        }

        .stat-card.total { border-left: 4px solid #4CAF50; }
        .stat-card.rectified { border-left: 4px solid #2196F3; }
        .stat-card.pending { border-left: 4px solid #FF9800; }
        .stat-card.week-inspected { border-left: 4px solid #9C27B0; }
        .stat-card.week-rectified { border-left: 4px solid #00BCD4; }

        .stat-number {
            font-size: 28px;
            font-weight: 700;
            color: #333;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .office-counts {
            border-top: 1px solid #e0e0e0;
            padding-top: 12px;
            margin-top: 8px;
        }

        .office-count-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            font-size: 11px;
        }

        .office-count-row:last-child {
            margin-bottom: 0;
        }

        .office-count-label {
            color: #666;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .office-count-value {
            color: #333;
            font-weight: 600;
            font-size: 12px;
        }

        .office-count-name {
            color: #555;
            font-size: 10px;
            margin-left: 4px;
            opacity: 0.8;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 120px;
        }

        .charts-section {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 16px;
            color: #333;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
        }

        .timeline-chart {
            height: 400px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 500;
        }

        .close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .close:hover {
            background: rgba(255,255,255,0.2);
        }

        .modal-body {
            padding: 20px;
            max-height: 50vh;
            overflow-y: auto;
        }

        .office-summary {
            display: grid;
            gap: 12px;
        }

        .office-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            border-left: 4px solid #2196F3;
        }

        .office-item.clickable {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .office-item.clickable:hover {
            background: #e3f2fd;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .office-name {
            font-weight: 500;
            margin-bottom: 8px;
            color: #333;
        }

        .office-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            font-size: 12px;
        }

        .office-stat {
            text-align: center;
            padding: 8px;
            background: white;
            border-radius: 4px;
        }

        .office-stat-number {
            display: block;
            font-weight: 600;
            font-size: 16px;
            color: #333;
        }

        .office-stat-label {
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Details Modal Styles */
        .details-modal {
            z-index: 1100;
        }

        .details-list {
            display: grid;
            gap: 12px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .detail-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            border-left: 4px solid #FF9800;
        }

        .detail-location {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .detail-description {
            color: #555;
            font-size: 13px;
            line-height: 1.5;
            word-wrap: break-word;
            word-break: break-word;
            hyphens: auto;
        }

        .detail-meta {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e0e0e0;
            font-size: 11px;
            color: #666;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .detail-meta-item {
            display: flex;
            flex-direction: column;
        }

        .detail-meta-label {
            font-weight: 500;
            margin-bottom: 2px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-meta-value {
            color: #333;
        }

        .no-items {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            font-style: italic;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }

            .header {
                margin: -12px -12px 20px -12px;
                padding: 20px 12px;
            }

            .header h1 {
                font-size: 20px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            .stat-card {
                padding: 16px;
            }

            .stat-number {
                font-size: 24px;
            }

            .office-count-name {
                max-width: 80px;
            }

            .chart-wrapper {
                height: 250px;
            }

            .timeline-chart {
                height: 300px;
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .office-stats {
                grid-template-columns: 1fr;
            }

            .office-count-name {
                max-width: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Safety Inspection Dashboard</h1>
            <p>Monitor inspection progress and rectification status</p>
            <div class="updated-on" id="updatedOn">
                Last updated: Loading...
            </div>
        </div>

        <div id="loading" class="loading">
            <p>Loading inspection data...</p>
        </div>

        <div id="dashboard" style="display: none;">
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card total" onclick="openModal('total')">
                    <div class="stat-number" id="totalInspected">0</div>
                    <div class="stat-label">Total Inspected</div>
                    <div class="office-counts" id="totalOfficeCounts"></div>
                </div>
                <div class="stat-card rectified" onclick="openModal('rectified')">
                    <div class="stat-number" id="totalRectified">0</div>
                    <div class="stat-label">Total Rectified</div>
                    <div class="office-counts" id="rectifiedOfficeCounts"></div>
                </div>
                <div class="stat-card pending" onclick="openModal('pending')">
                    <div class="stat-number" id="totalPending">0</div>
                    <div class="stat-label">Total Pending</div>
                    <div class="office-counts" id="pendingOfficeCounts"></div>
                </div>
                <div class="stat-card week-inspected" onclick="openModal('weekInspected')">
                    <div class="stat-number" id="weekInspected">0</div>
                    <div class="stat-label">Inspected This Week</div>
                    <div class="office-counts" id="weekInspectedOfficeCounts"></div>
                </div>
                <div class="stat-card week-rectified" onclick="openModal('weekRectified')">
                    <div class="stat-number" id="weekRectified">0</div>
                    <div class="stat-label">Rectified This Week</div>
                    <div class="office-counts" id="weekRectifiedOfficeCounts"></div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-section">
                <div class="chart-container">
                    <div class="chart-title">Office-wise Status Distribution</div>
                    <div class="chart-wrapper">
                        <canvas id="officeChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">Inspection vs Rectification Timeline</div>
                    <div class="chart-wrapper timeline-chart">
                        <canvas id="timelineChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal -->
        <div id="modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="modalTitle">Office Summary</div>
                    <button class="close" onclick="closeModal()">&times;</button>
                </div>
                <div class="modal-body" id="modalBody">
                </div>
            </div>
        </div>

        <!-- Details Modal -->
        <div id="detailsModal" class="modal details-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="detailsModalTitle">Pending Items Details</div>
                    <button class="close" onclick="closeDetailsModal()">&times;</button>
                </div>
                <div class="modal-body" id="detailsModalBody">
                </div>
            </div>
        </div>
    </div>

    <script>
        let inspectionData = [];
        let officeChart, timelineChart;
        let currentModalData = [];
        let lastUpdatedDate = null;

        // Utility functions
        function parseDate(dateStr) {
            if (!dateStr || dateStr.trim() === '') return null;
            const parts = dateStr.split('/');
            if (parts.length !== 3) return null;
            return new Date(parts[2], parts[1] - 1, parts[0]);
        }

        function cleanOfficeName(officeName) {
            return officeName.replace(/\s*\(\d{7}\)$/, '').trim();
        }

        function isWithinLastWeek(date) {
            if (!date) return false;
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            return date >= weekAgo;
        }

        function getOfficeCountsHtml(officeStats) {
            const offices = Object.keys(officeStats);
            if (offices.length === 0) return '';
            
            // Sort offices by count (descending)
            offices.sort((a, b) => officeStats[b].count - officeStats[a].count);
            
            const highest = offices[0];
            const lowest = offices[offices.length - 1];
            
            let html = '';
            
            // Show highest count office
            html += `
                <div class="office-count-row">
                    <span class="office-count-label">Highest:</span>
                    <span>
                        <span class="office-count-value">${officeStats[highest].count}</span>
                        <span class="office-count-name" title="${highest}">${highest}</span>
                    </span>
                </div>
            `;
            
            // Show lowest count office (only if different from highest)
            if (lowest !== highest) {
                html += `
                    <div class="office-count-row">
                        <span class="office-count-label">Lowest:</span>
                        <span>
                            <span class="office-count-value">${officeStats[lowest].count}</span>
                            <span class="office-count-name" title="${lowest}">${lowest}</span>
                        </span>
                    </div>
                `;
            }
            
            return html;
        }

        // Load and process data
        async function loadData() {
            try {
                const response = await fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vTUm6Gh0XpY34TNrlP1vR767xZQ8KGAHmx4jKVSoai-QB07mo5eblxOmjaE9OiTMy8FdoqYdhZ3izmE/pub?gid=612020297&single=true&output=csv');
                const csvText = await response.text();
                
                Papa.parse(csvText, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        inspectionData = results.data.map(row => {
                            const updatedOnDate = parseDate(row['Updated on']);
                            if (updatedOnDate && (!lastUpdatedDate || updatedOnDate > lastUpdatedDate)) {
                                lastUpdatedDate = updatedOnDate;
                            }
                            
                            return {
                                office: cleanOfficeName(row.Office || ''),
                                location: row.Location || '',
                                description: row.Description || '',
                                rectificationDoneBy: row['Rectification done by'] || '',
                                rectificationDoneOn: parseDate(row['Rectification done on']),
                                remarks: row.Remarks || '',
                                status: row.Status || '',
                                enteredOn: parseDate(row['Entered on']) || new Date(),
                                updatedOn: updatedOnDate,
                                isRectified: row['Rectification done on'] && row['Rectification done on'].trim() !== ''
                            };
                        });
                        
                        // Update the "Updated on" information in header
                        const updatedOnElement = document.getElementById('updatedOn');
                        if (lastUpdatedDate) {
                            updatedOnElement.textContent = `Last updated: ${lastUpdatedDate.toLocaleDateString('en-GB')} at ${lastUpdatedDate.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' })}`;
                        } else {
                            updatedOnElement.textContent = 'Last updated: Information not available';
                        }
                        
                        processData();
                        document.getElementById('loading').style.display = 'none';
                        document.getElementById('dashboard').style.display = 'block';
                    }
                });
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading').innerHTML = '<p>Error loading data. Please try again later.</p>';
            }
        }

        function processData() {
            // Calculate stats
            const totalInspected = inspectionData.length;
            const totalRectified = inspectionData.filter(item => item.isRectified).length;
            const totalPending = totalInspected - totalRectified;
            
            const weekInspected = inspectionData.filter(item => isWithinLastWeek(item.enteredOn)).length;
            const weekRectified = inspectionData.filter(item => 
                item.isRectified && isWithinLastWeek(item.rectificationDoneOn)
            ).length;

            // Update stat cards
            document.getElementById('totalInspected').textContent = totalInspected;
            document.getElementById('totalRectified').textContent = totalRectified;
            document.getElementById('totalPending').textContent = totalPending;
            document.getElementById('weekInspected').textContent = weekInspected;
            document.getElementById('weekRectified').textContent = weekRectified;

            // Update office counts for each card
            updateOfficeCountsForCard('total', inspectionData);
            updateOfficeCountsForCard('rectified', inspectionData.filter(item => item.isRectified));
            updateOfficeCountsForCard('pending', inspectionData.filter(item => !item.isRectified));
            updateOfficeCountsForCard('weekInspected', inspectionData.filter(item => isWithinLastWeek(item.enteredOn)));
            updateOfficeCountsForCard('weekRectified', inspectionData.filter(item => 
                item.isRectified && isWithinLastWeek(item.rectificationDoneOn)
            ));

            // Create charts
            createOfficeChart();
            createTimelineChart();
        }

        function updateOfficeCountsForCard(cardType, data) {
            const officeStats = {};
            
            data.forEach(item => {
                if (!officeStats[item.office]) {
                    officeStats[item.office] = { count: 0 };
                }
                officeStats[item.office].count++;
            });
            
            const elementId = cardType === 'total' ? 'totalOfficeCounts' :
                             cardType === 'rectified' ? 'rectifiedOfficeCounts' :
                             cardType === 'pending' ? 'pendingOfficeCounts' :
                             cardType === 'weekInspected' ? 'weekInspectedOfficeCounts' :
                             'weekRectifiedOfficeCounts';
            
            const element = document.getElementById(elementId);
            element.innerHTML = getOfficeCountsHtml(officeStats);
        }

        function createOfficeChart() {
            const officeStats = {};
            
            inspectionData.forEach(item => {
                if (!officeStats[item.office]) {
                    officeStats[item.office] = { total: 0, rectified: 0, pending: 0 };
                }
                officeStats[item.office].total++;
                if (item.isRectified) {
                    officeStats[item.office].rectified++;
                } else {
                    officeStats[item.office].pending++;
                }
            });

            const offices = Object.keys(officeStats);
            const rectifiedData = offices.map(office => officeStats[office].rectified);
            const pendingData = offices.map(office => officeStats[office].pending);

            const ctx = document.getElementById('officeChart').getContext('2d');
            officeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: offices,
                    datasets: [
                        {
                            label: 'Rectified',
                            data: rectifiedData,
                            backgroundColor: '#2196F3',
                            borderRadius: 4
                        },
                        {
                            label: 'Pending',
                            data: pendingData,
                            backgroundColor: '#FF9800',
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            ticks: {
                                maxRotation: 45
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function createTimelineChart() {
            const monthlyData = {};
            
            inspectionData.forEach(item => {
                const enteredMonth = item.enteredOn.toISOString().slice(0, 7);
                if (!monthlyData[enteredMonth]) {
                    monthlyData[enteredMonth] = { inspected: 0, rectified: 0 };
                }
                monthlyData[enteredMonth].inspected++;
                
                if (item.rectificationDoneOn) {
                    const rectifiedMonth = item.rectificationDoneOn.toISOString().slice(0, 7);
                    if (!monthlyData[rectifiedMonth]) {
                        monthlyData[rectifiedMonth] = { inspected: 0, rectified: 0 };
                    }
                    monthlyData[rectifiedMonth].rectified++;
                }
            });

            const months = Object.keys(monthlyData).sort();
            const inspectedData = months.map(month => monthlyData[month].inspected);
            const rectifiedData = months.map(month => monthlyData[month].rectified);

            const ctx = document.getElementById('timelineChart').getContext('2d');
            timelineChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months.map(month => {
                        const date = new Date(month + '-01');
                        return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                    }),
                    datasets: [
                        {
                            label: 'Inspections',
                            data: inspectedData,
                            borderColor: '#4CAF50',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Rectifications',
                            data: rectifiedData,
                            borderColor: '#2196F3',
                            backgroundColor: 'rgba(33, 150, 243, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function openModal(type) {
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            let title = '';
            let filteredData = [];
            
            switch(type) {
                case 'total':
                    title = 'Total Inspected - Office Summary';
                    filteredData = inspectionData;
                    break;
                case 'rectified':
                    title = 'Rectified Items - Office Summary';
                    filteredData = inspectionData.filter(item => item.isRectified);
                    break;
                case 'pending':
                    title = 'Pending Items - Office Summary';
                    filteredData = inspectionData.filter(item => !item.isRectified);
                    break;
                case 'weekInspected':
                    title = 'This Week Inspected - Office Summary';
                    filteredData = inspectionData.filter(item => isWithinLastWeek(item.enteredOn));
                    break;
                case 'weekRectified':
                    title = 'This Week Rectified - Office Summary';
                    filteredData = inspectionData.filter(item => 
                        item.isRectified && isWithinLastWeek(item.rectificationDoneOn)
                    );
                    break;
            }
            
            currentModalData = filteredData;
            modalTitle.textContent = title;
            
            const officeStats = {};
            filteredData.forEach(item => {
                if (!officeStats[item.office]) {
                    officeStats[item.office] = { total: 0, rectified: 0, pending: 0 };
                }
                officeStats[item.office].total++;
                if (item.isRectified) {
                    officeStats[item.office].rectified++;
                } else {
                    officeStats[item.office].pending++;
                }
            });
            
            let html = '<div class="office-summary">';
Object.keys(officeStats)
    .sort((a, b) => officeStats[b].total - officeStats[a].total)
    .forEach(office => {
                const stats = officeStats[office];
                const hasPending = stats.pending > 0;
                html += `
                    <div class="office-item ${hasPending ? 'clickable' : ''}" ${hasPending ? `onclick="openDetailsModal('${office}')"` : ''}>
                        <div class="office-name">${office}</div>
                        <div class="office-stats">
                            <div class="office-stat">
                                <span class="office-stat-number">${stats.total}</span>
                                <span class="office-stat-label">Total</span>
                            </div>
                            <div class="office-stat">
                                <span class="office-stat-number">${stats.rectified}</span>
                                <span class="office-stat-label">Rectified</span>
                            </div>
                            <div class="office-stat">
                                <span class="office-stat-number">${stats.pending}</span>
                                <span class="office-stat-label">Pending</span>
                            </div>
                        </div>
                        ${hasPending ? '<div style="margin-top: 8px; font-size: 11px; color: #2196F3; font-weight: 500;">📝 Click to view pending details</div>' : ''}
                    </div>
                `;
            });
            html += '</div>';
            
            modalBody.innerHTML = html;
            modal.style.display = 'block';
        }

        function openDetailsModal(officeName) {
            const detailsModal = document.getElementById('detailsModal');
            const detailsModalTitle = document.getElementById('detailsModalTitle');
            const detailsModalBody = document.getElementById('detailsModalBody');
            
            const pendingItems = currentModalData.filter(item => 
                item.office === officeName && !item.isRectified
            );
            
            detailsModalTitle.textContent = `${officeName} - Pending Items (${pendingItems.length})`;
            
            if (pendingItems.length === 0) {
                detailsModalBody.innerHTML = '<div class="no-items">No pending items found for this office.</div>';
            } else {
                let html = '<div class="details-list">';
                pendingItems.forEach((item, index) => {
                    const enteredDate = item.enteredOn ? item.enteredOn.toLocaleDateString('en-GB') : 'N/A';
                    html += `
                        <div class="detail-item">
                            <div class="detail-location">${item.location || 'Location not specified'}</div>
                            <div class="detail-description">${item.description || 'No description available'}</div>
                            <div class="detail-meta">
                                <div class="detail-meta-item">
                                    <span class="detail-meta-label">Entered On</span>
                                    <span class="detail-meta-value">${enteredDate}</span>
                                </div>
                                <div class="detail-meta-item">
                                    <span class="detail-meta-label">Status</span>
                                    <span class="detail-meta-value">${item.status || 'Pending'}</span>
                                </div>
                            </div>
                            ${item.remarks ? `
                                <div class="detail-meta" style="margin-top: 8px; grid-template-columns: 1fr;">
                                    <div class="detail-meta-item">
                                        <span class="detail-meta-label">Remarks</span>
                                        <span class="detail-meta-value">${item.remarks}</span>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                html += '</div>';
                detailsModalBody.innerHTML = html;
            }
            
            detailsModal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        function closeDetailsModal() {
            document.getElementById('detailsModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('modal');
            const detailsModal = document.getElementById('detailsModal');
            if (event.target === modal) {
                closeModal();
            }
            if (event.target === detailsModal) {
                closeDetailsModal();
            }
        }

        // Initialize
        loadData();
    </script>
</body>
</html>
