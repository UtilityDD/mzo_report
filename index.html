<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, viewport-fit=cover" name="viewport"/>
<title>MZO Reports</title>
<link href="manifest.json" rel="manifest"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&amp;display=swap" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet"/>
<style>
/*──────────────────────────────────────
   Global reset
──────────────────────────────────────*/
*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

:root {
  --bg-dark: #0f172a;
  --bg-med: rgba(31, 41, 55, 0.5);
  --bg-light: rgba(55, 65, 81, 0.4);
  --border-color: rgba(255, 255, 255, 0.1);
  --text-primary: #f9fafb;
  --text-secondary: #9ca3af;
  --accent-primary: #4f46e5;
  --accent-secondary: #7c3aed;
  --danger: #f43f5e;
  
  /* New mobile-specific variables */
  --mobile-bg: #f8fafc;
  --mobile-text-primary: #111827;
  --mobile-text-secondary: #4b5563;
  --mobile-border: #e2e8f0;
  --mobile-card-bg: #ffffff;
  --mobile-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
  --mobile-shadow-hover: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
}

/*──────────────────────────────────────
   Base styles - Modern Dark Theme
──────────────────────────────────────*/
html, body {
  width: 100%;
  height: 100%;
  overflow-x: hidden;
}

body {
  font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background-color: var(--bg-dark);
  background-image: 
    radial-gradient(at 10% 20%, hsla(260, 80%, 40%, 0.2) 0px, transparent 50%),
    radial-gradient(at 80% 15%, hsla(212, 70%, 50%, 0.25) 0px, transparent 50%),
    radial-gradient(at 75% 85%, hsla(320, 65%, 35%, 0.15) 0px, transparent 50%);
  color: var(--text-secondary);
  min-height: 100vh;
}

/*──────────────────────────────────────
   Layout
──────────────────────────────────────*/
#mainApp, #pageContainer {
  width: 100%;
  max-width: 100vw;
  overflow-x: hidden;
}

.page {
  position: relative;
  width: 100%;
  max-width: 100vw;
  height: 100vh;
  display: none;
  overflow-y: auto;
  overflow-x: hidden;
}

.page.active {
  display: block;
}

/*──────────────────────────────────────
   App container & grid - Modern Dark Theme
──────────────────────────────────────*/
.app-container {
  width: 100%;
  max-width: 800px;
  margin: 0 auto;
  background: transparent;
  min-height: calc(100vh - 56px - 48px);
  overflow-x: visible;
}

.report-grid {
  display: grid;
  gap: 16px;
  width: 100%;
}

@media (min-width: 768px) {
  .report-grid { 
    grid-template-columns: repeat(2, 1fr); 
  }
  .app-container { 
    max-width: 800px;
    border-radius: 16px;
    border: none;
    box-shadow: none;
  }
}

/*──────────────────────────────────────
   Header - Modern Dark Theme
──────────────────────────────────────*/
.header {
  background: rgba(31, 41, 55, 0.5);
  backdrop-filter: blur(16px);
  color: white;
  padding: 16px;
  position: sticky;
  top: 0;
  z-index: 1000;
  width: 100%;
  max-width: 100vw;
  overflow: hidden;
  border-bottom: 1px solid var(--border-color);
}

.header-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 12px;
  flex: 1;
  min-width: 0;
}

.header-texts {
  flex: 1;
  min-width: 0;
}

.main-title {
  font-size: 24px;
  font-weight: 600;
  word-wrap: break-word;
  color: var(--text-primary);
}

.subtitle {
  font-size: 14px;
  opacity: 0.9;
  margin-top: 2px;
  color: var(--text-secondary);
}

/*──────────────────────────────────────
   Icons & refresh button - Modern Dark Theme
──────────────────────────────────────*/
.header-icon, .refresh-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  background: var(--bg-light);
  cursor: pointer;
  transition: all 0.2s ease;
  flex-shrink: 0;
  border: none;
}

.header-icon {
  width: 40px;
  height: 40px;
  font-size: 18px;
}

.refresh-icon {
  width: 44px;
  height: 44px;
  color: var(--text-primary);
  outline: none;
  position: relative;
  z-index: 1;
}

.refresh-icon:hover {
  background: var(--border-color);
  transform: translateY(-2px) scale(1.05);
}

.refresh-icon:active {
  transform: translateY(0) scale(1);
}

.refresh-icon.spinning {
  animation: spin 1s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to   { transform: rotate(360deg); }
}

#detailPage .header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

/*──────────────────────────────────────
   Error banner - Dark Theme
──────────────────────────────────────*/
.error-banner {
  display: none;
  background: rgb(153 27 27 / 0.2);
  color: #fca5a5;
  padding: 12px 16px;
  border-left: 4px solid var(--danger);
  margin: 16px;
  border-radius: 8px;
  word-wrap: break-word;
}

/*──────────────────────────────────────
   Content & cards - Modern Dark Theme
──────────────────────────────────────*/
.content {
  padding: 0 16px 100px; /* Remove top padding, keep side/bottom */
  width: 100%;
  max-width: 100vw;
}

.report-card { /* This is now the group container */
  background: var(--bg-light);
  backdrop-filter: blur(12px);
  border-radius: 16px;
  margin-bottom: 0;
  padding: 0;
  border: 1px solid var(--border-color);
  box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
  transition: box-shadow 0.3s ease;
  width: 100%;
  overflow: visible;
  position: relative;
  
  /* Animation for cards on page load */
  opacity: 0;
  transform: translateY(20px);
  animation: cardFadeIn 0.5s cubic-bezier(0.215, 0.610, 0.355, 1) forwards;
}

.report-card:hover {
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
  border-color: rgba(255, 255, 255, 0.2);
}

@keyframes cardFadeIn {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.card-header {
  position: absolute;
  top: -14px; /* Pulls the header up over the border */
  left: 20px;
  padding: 4px 10px; /* Small padding for the "legend" */
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: default; /* No longer clickable */
  width: 100%;
  border-bottom: none; /* No longer needed */
  width: auto; /* Allow it to size to its content */
}

.card-header-left {
  display: flex;
  flex: 1;
  min-width: 0;
}

.card-icon {
  width: 48px;
  height: 48px;
  display: flex; 
  align-items: center; 
  justify-content: center;
  font-size: 28px;
  color: var(--text-primary);
  flex-shrink: 0;
  background: transparent; 
  display: none; /* Remove icon from all views as requested */
}

.card-title {
  font-weight: 500;
  font-size: 16px;
  color: var(--text-primary);
  text-align: left;
  line-height: 1.4;
  word-wrap: break-word;
  flex: 1;
}

.chevron {
  font-size: 18px;
  color: var(--text-secondary);
  display: none; /* Chevron not needed for this design */
  flex-shrink: 0;
}

.chevron.rotated {
  transform: rotate(180deg);
}

.sub-options {
  /* This is now the grid container for app items */
  display: grid;
  gap: 12px;
  padding: 24px 16px 16px; /* Add top padding to clear the new header */
  background: var(--bg-med);
  border-top: 1px solid var(--border-color);
  width: 100%;
  grid-template-columns: repeat(4, 1fr); /* Mobile default */
}

.sub-option {
  /* This is now the app-style card */
  background: var(--bg-light);
  border-radius: 12px;
  padding: 16px 8px;
  text-decoration: none;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  min-height: 110px;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  border: 1px solid transparent;
}

.sub-option:hover {
  transform: scale(1.05);
  box-shadow: 0 8px 20px rgba(0,0,0,0.25);
  border-color: rgba(255,255,255,0.15);
  background: rgba(70, 80, 95, 0.6);
}

.sub-option .app-icon {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 22px;
  margin-bottom: 10px;
  color: #fff;
  flex-shrink: 0;
}

.sub-option .app-label {
  font-size: 13px;
  font-weight: 500;
  color: var(--text-secondary);
  line-height: 1.3;
}

/* Icon colors for the new app-style cards */
.app-icon.connections { background-color: #10b981; }
.app-icon.financial   { background-color: #f59e0b; }
.app-icon.maintenance { background-color: #8b5cf6; }
.app-icon.visits      { background-color: #f43f5e; }
.app-icon.grievance   { background-color: #f97316; }
.app-icon.revenue     { background-color: #06b6d4; }
.app-icon.water       { background-color: #3b82f6; }
.app-icon.safety      { background-color: #84cc16; }
.app-icon.solar       { background-color: #eab308; }
.app-icon.industrial  { background-color: #6366f1; }
.app-icon.civil       { background-color: #14b8a6; }
.app-icon.priority    { background-color: #d946ef; }

/* Light theme adjustments for app cards */
body.light-theme .report-card {
  background: #ffffff; /* Slightly off-white container */
}
body.light-theme .sub-options {
  background: none;
}
body.light-theme .sub-option {
  background: var(--mobile-card-bg); /* White cards */
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  border: 1px solid var(--mobile-border);
}
body.light-theme .sub-option:hover {
  box-shadow: var(--mobile-shadow-hover);
}
body.light-theme .sub-option .app-label { color: var(--mobile-text-secondary); }
/*──────────────────────────────────────
   Card-icon color variants - Modern
──────────────────────────────────────*/
.card-icon.connections { color: #10b981; }
.card-icon.financial   { color: #f59e0b; }
.card-icon.maintenance { color: #8b5cf6; }
.card-icon.visits      { color: #f43f5e; }
.card-icon.grievance   { color: #f97316; }
.card-icon.revenue     { color: #06b6d4; }
.card-icon.water       { color: #3b82f6; }
.card-icon.safety      { color: #84cc16; }
.card-icon.solar       { color: #eab308; }
.card-icon.industrial  { color: #6366f1; }
.card-icon.civil       { color: #14b8a6; }
.card-icon.priority    { 
  background: linear-gradient(135deg, #d946ef, #a855f7);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/*──────────────────────────────────────
   Detail‐page iframe - Dark Theme
──────────────────────────────────────*/
#subPageFrame {
  width: 100%;
  height: calc(100vh - 56px);
  border: none;
  background-color: var(--bg-dark);
}

/*──────────────────────────────────────
   Loading overlay - Dark Theme
──────────────────────────────────────*/
.loading-overlay {
  position: fixed;
  top: 0; 
  left: 0;
  width: 100%; 
  height: 100%;
  background: rgba(17, 24, 39, 0.8);
  z-index: 9999;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s, visibility 0.3s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.loading-overlay.active {
  opacity: 1;
  visibility: visible;
}

.loading-overlay::after {
  content: '';
  border: 5px solid var(--bg-light);
  border-top: 5px solid var(--text-secondary);
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 1s linear infinite;
}

/*──────────────────────────────────────
   Footer - Dark Theme
──────────────────────────────────────*/
.footer {
  position: fixed;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 100%;
  max-width: 800px;
  background: rgba(31, 41, 55, 0.5);
  backdrop-filter: blur(16px);
  color: var(--text-secondary);
  font-size: 12px;
  padding: 16px;
  border-top: 1px solid var(--border-color);
  z-index: 1000;
}

/*──────────────────────────────────────
   Mobile-specific modern redesign
──────────────────────────────────────*/
@media (max-width: 767px) {
  /* Default mobile body styles */
  body.dark-theme {
    background-color: var(--bg-dark);
    color: var(--text-secondary);
  }
  body.light-theme {
    background-image: none;
  }
  
  .content {
    padding: 0 8px 100px; /* Remove top padding for mobile */
    padding-bottom: 100px; /* This is redundant but safe */
  }
  
  body.light-theme .content { background: #f8fafc; }
  body.dark-theme .content { background: transparent; }
  
  
  /* Mobile header layout */
  .header {
    padding: calc(30px + env(safe-area-inset-top)) 16px 12px;
  }

  /* Dark theme mobile header */
  body.dark-theme .header {
    background: rgba(31, 41, 55, 0.5);
    backdrop-filter: blur(16px);
    color: white;
    border-bottom: 1px solid var(--border-color);
  }

  /* Light theme mobile header */
  body.light-theme .header {
    box-shadow: var(--mobile-shadow);
  }
  
  /* Light theme mobile header icons */
  body.light-theme .header-icon {
    background: var(--mobile-bg);
    color: var(--mobile-text-primary);
    border: 1px solid #e2e8f0;
  }
  
  /* Dark theme mobile header icons */
  body.dark-theme .header-icon {
    background: var(--bg-light);
    color: var(--text-primary);
  }

  body.dark-theme .refresh-icon {
    background: var(--bg-light);
    color: var(--text-primary);
    border: none;
  }

  body.light-theme .refresh-icon {
    background: var(--mobile-bg);
    color: var(--mobile-text-primary);
    border: 1px solid #e2e8f0;
    width: 40px;
    height: 40px;
  }
  
  .refresh-icon:hover {
    background: #f3f4f6;
    transform: none;
    border-color: #d1d5db;
  }
  
  .main-title {
    font-size: 20px;
    font-weight: 700;
  }
  
  body.light-theme .main-title { color: var(--mobile-text-primary); }
  body.dark-theme .main-title { color: var(--text-primary); }

  .subtitle {
    font-size: 13px;
  }
  
  body.light-theme .subtitle { color: var(--mobile-text-secondary); }
  body.dark-theme .subtitle { color: var(--text-secondary); }

  /* Clean mobile grid */
  .report-grid {
    grid-template-columns: 1fr;
    gap: 12px;
  }

  /* Modern mobile cards */
  .report-card {
    backdrop-filter: none;
    border-radius: 12px;
    margin: 0;
    transition: all 0.2s ease;
  }

  body.dark-theme .report-card {
    background: var(--bg-light);
    border: 1px solid var(--border-color);
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
  }
  body.light-theme .report-card {
    background: var(--mobile-card-bg);
    border: 1px solid var(--mobile-border);
    box-shadow: var(--mobile-shadow);
  }
  
  .report-card:hover {
    transform: none;
    box-shadow: 0 4px 8px rgba(0,0,0,0.08);
    border-color: #d1d5db;
  }

  body.dark-theme .report-card:hover {
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
    border-color: rgba(255, 255, 255, 0.2);
  }

  /* Clean card headers */
  .card-header {
    top: -12px; /* Adjust position for mobile */
    left: 12px;
    cursor: default;
  }

  body.dark-theme .card-header { background: transparent; }
  body.light-theme .card-header { background: transparent; }

  .card-header .card-icon {
    display: none;
  }

  .card-header .chevron {
    display: none;
  }

  .card-title {
    font-size: 14px;
    font-weight: 500;
  }

  body.dark-theme .card-title {
    color: var(--text-primary);
  }
  body.light-theme .card-title {
    color: var(--mobile-text-primary);
  }

  /* Modern grid layout for sub-options */
  .sub-options {
    display: grid; /* Already grid, but confirm columns */
    grid-template-columns: repeat(3, 1fr); /* 3 columns on mobile */
    gap: 8px;
    max-height: none; /* Ensure it's visible */
    overflow: visible;
    border-top: 1px solid var(--border-color); /* Restore border for visual separation */
    padding: 20px 12px 12px; /* Increased top padding for more space */
  }

  body.dark-theme .sub-options {
    background: var(--bg-med);
  }
  body.light-theme .sub-options {
    background: #e2e8f0; /* Match page background for a clear "inset" look */
  }

  /* Clean modern sub-option tiles */
  .sub-option {
    /* This is the app-style card on mobile */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 12px 8px;
    font-weight: 500;
    font-size: 12px;
    text-align: center;
    min-height: 90px;
    transition: all 0.2s ease;
    text-decoration: none;
    box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    border: 1px solid #f1f5f9;
  }
  body.dark-theme .sub-option {
    background: var(--bg-light); /* Keep dark theme as is */
    border: 1px solid var(--border-color);
    color: var(--text-secondary);
  }
  body.light-theme .sub-option {
    background: var(--mobile-card-bg);
    border: 1px solid var(--mobile-border);
    color: var(--mobile-text-secondary);
  }

  .sub-option .app-label {
    font-weight: 500;
    font-size: 12px;
  }

  .sub-option:hover {
    background: #f8fafc;
    color: var(--mobile-text-primary);
    border-color: #e2e8f0;
    border-left-color: #d1d5db;
    box-shadow: var(--mobile-shadow);
  }

  body.dark-theme .sub-option:hover {
    background: rgba(55, 65, 81, 0.6);
    color: var(--text-primary);
    border-left-color: var(--accent-primary);
    box-shadow: none;
  }

  .sub-option .app-icon {
    width: 44px;
    height: 44px;
    font-size: 20px;
    margin-bottom: 4px;
  }
  
  /* Mobile footer */
  body.dark-theme .footer {
    background: rgba(31, 41, 55, 0.5);
    backdrop-filter: blur(16px);
    color: var(--text-secondary);
    border-top: 1px solid var(--border-color);
  }

  body.light-theme .footer {
    background: var(--mobile-bg);
    color: var(--mobile-text-secondary);
    border-top: 1px solid #e2e8f0;
    backdrop-filter: none;
    box-shadow: 0 -1px 3px 0 rgb(0 0 0 / 0.1);
  }
  
  /* Mobile action buttons */
  .action-btn-container {
    margin: 16px 8px;
    gap: 8px;
  }
  
  .btn {
    height: 44px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 14px;
  }
  
  .btn-docket {
    background: linear-gradient(135deg, #dc2626, #991b1b);
    box-shadow: 0 2px 4px rgb(220 38 38 / 0.2);
  }
  
  /* Light theme mobile KPI button */
  body.light-theme .btn-kpi {
    background: var(--mobile-bg);
    color: var(--mobile-text-primary);
    border: 1px solid #e2e8f0;
    box-shadow: var(--mobile-shadow);
  }

  /* Dark theme mobile KPI button */
  body.dark-theme .btn-kpi {
    background: var(--bg-light);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  }
  .btn:hover {
    transform: none;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
  }
  
  /* Mobile error banner */
  body.dark-theme .error-banner {
    background: rgb(153 27 27 / 0.2);
    color: #fca5a5;
    border-left-color: var(--danger);
    margin: 12px 8px;
    border-radius: 8px;
  }
  body.light-theme .error-banner {
    background: #fef2f2;
    color: #dc2626;
    border-left-color: #dc2626;
    margin: 12px 8px;
    border-radius: 8px;
  }
}

/* Desktop enhancements - Dark Theme & Thin 3D */
@media (min-width: 1024px) {
  body {
    background: var(--bg-dark);
  }

  /* Responsive grid for sub-options on desktop */
  .sub-options {
    grid-template-columns: repeat(5, 1fr); /* 5 columns on desktop */
  }
}

/* Detail page back button */
.back-button {
  background: none;
  border: none;
  color: white;
  margin-right: 16px;
  cursor: pointer;
  padding: 0;
  border-radius: 0;
  box-shadow: none;
  transition: all 0.2s ease;
}

/* Theme-aware back button color */
body.light-theme .back-button {
  color: var(--mobile-text-primary);
}
.back-button:hover {
  opacity: 0.8;
}

.back-button:active {
  transform: scale(0.95);
}

/* iframe wrapper adjustments */
#iframeWrapper {
  height: calc(100vh - 56px); 
  overflow-y: auto; 
  -webkit-overflow-scrolling: touch;
  width: 100%;
  max-width: 100vw;
}

#iframeError {
  display: none;
  position: absolute;
  top: 56px;
  left: 0;
  width: 100%;
  height: calc(100% - 56px);
  background: var(--bg-dark);
  color: var(--text-secondary);
  font-size: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 20px;
  z-index: 10;
}

#iframeError button {
  background: var(--danger);
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.2s ease;
}

#iframeError button:hover {
  background: #c22545;
}

#pullToRefresh {
  display: none; 
  text-align: center; 
  padding: 10px;
  color: var(--text-secondary);
  font-weight: 500; 
  font-size: 14px;
}

.sub-option img {
  margin-right: 10px;
  vertical-align: middle;
}

.loading-text {
  padding: 16px;
  color: var(--text-secondary);
  font-style: italic;
  text-align: center;
}

@keyframes blinkAnim {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}

@keyframes livePulseRed {
  0% {
    box-shadow: 0 0 0 0 hsla(349, 89%, 60%, 0.7);
  }
  70% {
    box-shadow: 0 0 0 10px hsla(349, 89%, 60%, 0);
  }
  100% {
    box-shadow: 0 0 0 0 hsla(349, 89%, 60%, 0);
  }
}

/* Styles for the Notice Modal - Prominent Light Theme */
#noticeModal {
  position: fixed;
  top: 0; left: 0; width: 100vw; height: 100vh;
  background-color: rgba(15, 23, 42, 0.8);
  backdrop-filter: blur(4px);
  z-index: 9999;
  font-family: 'Segoe UI', sans-serif;
  display: flex; align-items: center; justify-content: center;
  padding: 15px;
}

#noticeModal > div {
  background-color: #ffffff;
  border-radius: 16px;
  width: 100%;
  max-width: 600px;
  padding: 30px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(0,0,0,0.05);
  max-height: 90vh;
  overflow-y: auto;
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  border: 1px solid rgba(0,0,0,0.1);
}

#quoteSection {
  color: #4b5563;
  font-family: 'Lora', serif;
  font-size: 28px;
  line-height: 1.6;
  font-weight: 700;
  text-align: center;
  border-bottom: 1px solid #e5e7eb;
  padding-bottom: 20px;
  margin: auto 0;
}

#noticeContentSection {
  display: none;
  text-align: left;
  flex-grow: 1;
  margin-bottom: 25px;
}

#noticeTitle {
  font-size: 24px;
  color: #1e3a8a;
  margin-top: 0;
  text-align: left;
  font-weight: 700;
}

#noticeBody {
  font-size: 16px;
  color: #374151;
  line-height: 1.7;
  white-space: pre-wrap;
  word-wrap: break-word;
  margin-top: 12px;
}

#noticeButtonSection {
  display: none;
  text-align: right;
  margin-top: 0;
}

#noticeButtonSection button {
  background-color: #2563eb;
  color: #fff;
  border: none;
  padding: 12px 24px;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 4px 14px rgba(37, 99, 235, 0.3);
}

#noticeButtonSection button:hover {
  background-color: #1d4ed8;
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(37, 99, 235, 0.35);
}

#noticeButtonSection button:active {
  transform: translateY(0);
  box-shadow: 0 2px 8px rgba(37, 99, 235, 0.2);
}

/* Responsive adjustments for the modal */
@media (max-width: 768px) {
  #noticeModal > div {
    max-width: 95%;
    padding: 20px;
  }

  #quoteSection {
    font-size: 24px;
    padding-bottom: 15px;
    margin-bottom: 20px;
  }

  #quoteSection i {
    font-size: 22px;
  }

  #noticeTitle {
    font-size: 20px;
  }

  #noticeBody {
    font-size: 15px;
  }

  #noticeButtonSection button {
    padding: 10px 20px;
    font-size: 15px;
    width: 100%;
  }
}

/* New animation for the quote */
.quote-word {
  display: inline-block;
  opacity: 0;
  transform: translateY(15px) scale(0.95);
  animation: fadeInWord 0.5s cubic-bezier(0.215, 0.610, 0.355, 1) forwards;
}

@keyframes fadeInWord {
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* Smart forward button */
#forwardButtonContainer {
  text-align: center;
  margin-top: 20px;
}

#smartForwardBtn {
  background: #f3f4f6;
  border: 1px solid #e5e7eb;
  color: #4b5563;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 16px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0;
}

#smartForwardBtn:hover:not(:disabled) {
  background: #e5e7eb;
  transform: scale(1.05);
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

#smartForwardBtn:disabled {
  cursor: not-allowed;
  background: #e5e7eb;
}

.blinking-button {
  font-weight: 600;
  color: #f87171;
  background-color: transparent;
  border: 2px solid #991b1b;
  border-radius: 5px;
  cursor: pointer;
  animation: glowRed 1.5s infinite alternate;
  box-shadow: 0 0 0 rgba(153, 27, 27, 0);
}

@keyframes glowRed {
  0% {
    box-shadow: 0 0 5px rgba(153, 27, 27, 0.2);
  }
  100% {
    box-shadow: 0 0 20px rgba(153, 27, 27, 0.6);
  }
}

/* Add these new styles and modify existing ones */

/* Theme toggle button */
.theme-toggle {
  background: var(--bg-light);
  border: 1px solid var(--border-color);
  color: var(--text-primary);
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.2s ease;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  margin-left: 8px;
  outline: none;
}

.theme-toggle:hover {
  background: var(--border-color);
  transform: translateY(-2px) scale(1.05);
}

/* Center-aligned action buttons */
.action-btn-container {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
  margin: 16px 16px; /* Set equal vertical margin */
  padding: 0;
}

.btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 12px 20px;
  border: none;
  border-radius: 10px;
  font-family: 'Inter', sans-serif;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-decoration: none;
  color: white;
  min-height: 48px;
  flex: 0 1 auto; /* Change flex-grow to 0 */
  max-width: 180px;
}

.btn-docket {
  background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
  box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.btn-docket:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(79, 70, 229, 0.4);
  background: linear-gradient(135deg, #5b52f0 0%, #8b4cf7 100%);
}

.btn-kpi {
  background: var(--bg-light);
  backdrop-filter: blur(12px);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.btn-kpi:hover {
  transform: translateY(-3px);
  background: rgba(75, 85, 101, 0.6);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
  border-color: rgba(255, 255, 255, 0.2);
}

/* Mobile theme adjustments */
@media (max-width: 767px) {
  body.light-theme .theme-toggle {
    background: var(--mobile-bg);
    color: var(--mobile-text-primary);
    border: 1px solid #e2e8f0;
  }

  .theme-toggle {
    width: 40px;
    height: 40px;
  }
  
  .theme-toggle:hover {
    background: #f3f4f6;
  }

  .action-btn-container {
    margin: 12px 8px; /* Set equal vertical margin for mobile */
    gap: 8px;
  }
  
  .btn {
    height: 44px;
    border-radius: 8px;
    font-weight: 600;
    font-size: 14px;
    flex: 1;
    max-width: none;
  }
  
  .btn-docket {
    background: linear-gradient(135deg, #4f46e5, #7c3aed);
    box-shadow: 0 2px 8px rgba(79, 70, 229, 0.2);
    border: none;
  }
  
  .btn-docket:hover {
    transform: none;
    box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
  }
  
  body.light-theme .btn-kpi {
    background: var(--mobile-bg);
    color: var(--mobile-text-primary);
    border: 1px solid #e2e8f0;
    box-shadow: var(--mobile-shadow);
  }
  .btn-kpi:hover {
    transform: none;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    background: #f8fafc;
  }
}

/* Dark theme class for body */
body.dark-theme {
  background-color: var(--bg-dark);
  background-image: 
    radial-gradient(at 10% 20%, hsla(260, 80%, 40%, 0.2) 0px, transparent 50%),
    radial-gradient(at 80% 15%, hsla(212, 70%, 50%, 0.25) 0px, transparent 50%),
    radial-gradient(at 75% 85%, hsla(320, 65%, 35%, 0.15) 0px, transparent 50%);
  color: var(--text-secondary);
}

body.light-theme {
  background: #e2e8f0; /* Use a slightly darker grey for more contrast */
  /* Add a subtle noise texture for depth */
  background-image: url("data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%2394a3b8' fill-opacity='0.07' fill-rule='evenodd'%3E%3Cpath d='M5 0h1L0 6V5zM6 5v1H5z'/%3E%3C/g%3E%3C/svg%3E");
  color: var(--mobile-text-primary);
}

/* Theme-aware header */
body.light-theme .header {
  background: var(--mobile-bg);
  backdrop-filter: none;
  color: #111827;
  border-bottom: 1px solid var(--mobile-border);
  box-shadow: var(--mobile-shadow);
}

body.light-theme .refresh-icon:hover,
body.light-theme .theme-toggle:hover {
  background: #f3f4f6;
  border-color: #d1d5db;
}

body.light-theme .main-title {
  color: var(--mobile-text-primary);
}

body.light-theme .subtitle {
  color: var(--mobile-text-secondary);
}

/* Theme-aware content */
body.light-theme .content {
  background: transparent; /* Let body texture show through */
}

body.light-theme .footer {
  background: var(--mobile-bg);
  color: var(--mobile-text-secondary);
  border-top: 1px solid #e2e8f0;
  backdrop-filter: none;
  box-shadow: 0 -1px 3px 0 rgb(0 0 0 / 0.1);
}

/* Theme-aware cards for desktop light theme */
body.light-theme .report-card {
  background: #ffffff; /* Make card background pure white for better contrast */
  backdrop-filter: none;
  border: 1px solid #d1d5db; /* A more visible border to define card edges */
  box-shadow: var(--mobile-shadow);
}

body.light-theme .report-card:hover {
  box-shadow: var(--mobile-shadow-hover);
  border-color: #a7a7a7; /* Darker border on hover for better feedback */
}

body.light-theme .card-header {
  /* Inherits white background from .report-card */
  background: transparent; /* Remove background to show border behind text */
  border-bottom: none; /* Keep border none */
}

body.light-theme .card-title {
  color: var(--mobile-text-primary);
}

body.light-theme .sub-options {
  background: #e2e8f0; /* Match page background for a clear "inset" look */
  border-top: 1px solid #d1d5db; /* Use the card's border color */
  padding-top: 24px; /* Add top padding to clear the new header */
}

body.light-theme .sub-option {
  background: #ffffff; /* Make icon cards white to pop against the grey container */
  border: 1px solid #e5e7eb; /* A clear but subtle border */
  color: var(--mobile-text-secondary);
  box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); /* Add back a very subtle shadow for depth */
}

/* ---------- Modal button colour + size fixes (added) ---------- */
/* Ensure modal buttons are full-width and not affected by page .btn flex rules */
#sheetsModal .btn,
#sheetsModal a.btn {
  flex: none !important;
  width: 100% !important;
  max-width: none !important;
  min-height: 44px !important;
  padding: 10px 14px !important;
  border-radius: 10px !important;
  font-weight: 700 !important;
  color: white !important;
  display: inline-flex !important;
  align-items: center !important;
  justify-content: flex-start !important;
  gap: 10px !important;
  box-shadow: 0 6px 18px rgba(0,0,0,0.12);
}

/* Distinct colours for each sheet link */
#sheetsModal a.btn:nth-of-type(1) {
  background: linear-gradient(90deg,#f59e0b,#f97316);
  color: #0b1220;
}
#sheetsModal a.btn:nth-of-type(2) {
  background: linear-gradient(90deg,#ef4444,#be123c);
  color: #fff;
}
#sheetsModal a.btn:nth-of-type(3) {
  background: linear-gradient(90deg,#06b6d4,#0ea5a4);
  color: #042027;
}

/* Tweak the small icon inside to be consistent on desktop */
#sheetsModal a.btn i {
  width: 28px;
  text-align: center;
  font-size: 16px;
  opacity: 0.98;
}

/* Close button style (subtle) */
#sheetsModal > div > button[aria-label="Close"] {
  background: transparent;
  color: #374151;
  border-radius: 6px;
  padding: 6px;
}

/* Notice modal buttons: unify size and set a pleasant accent */
#noticeModal #noticeButtonSection button,
#noticeModal #smartForwardBtn {
  min-height: 44px;
  padding: 10px 16px;
  border-radius: 10px;
  font-weight: 700;
  border: none;
  cursor: pointer;
  box-shadow: 0 6px 18px rgba(0,0,0,0.12);
}

/* Continue button (notice modal) - green accent */
#noticeModal #noticeButtonSection button {
  background: linear-gradient(90deg,#10b981,#059669);
  color: #fff;
}

/* Smart forward button (intro) - festive accent */
#noticeModal #smartForwardBtn {
  background: linear-gradient(90deg,#f43f5e,#ef4444);
  color: #fff;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

/* Desktop-specific: ensure modal inner container doesn't force page-level flex rules */
@media (min-width: 768px) {
  #sheetsModal .btn,
  #noticeModal #noticeButtonSection button {
    max-width: 100%;
    width: 100%;
  }

  /* Reduce the overly large .btn min-height on desktop where not needed */
  .action-btn-container .btn {
    min-height: 44px;
    max-width: 220px;
  }
}
/* ---------- end added styles ---------- */
</style>

</head>
<body>  

<div id="mainApp" style="display: block;">

<div id="pageContainer"><div class="page active" id="mainPage"><div class="app-container">
<div class="error-banner" id="errorBanner">
<i class="fas fa-exclamation-triangle"></i>
      Connectivity issue detected. Please check your internet connection.
    </div>
<div class="header">


<div class="header-content">
<div class="header-row">
<div class="header-left">
<div class="header-icon">
<i class="fas fa-chart-line"></i>
</div>
<div class="header-texts">
<h1 class="main-title">MZO Reports</h1>
<div class="subtitle">Actionable Insights</div>
</div> 
</div><div style="display: flex; align-items: center; gap: 8px;"><button class="theme-toggle" id="themeToggleBtn" title="Toggle theme">
<i class="fas fa-sun"></i>
</button>
<button class="refresh-icon" id="mainRefreshBtn">
<i class="fas fa-sync-alt"></i>
</button> 
</div>
</div>
</div>

</div>
<div class="action-btn-container">
    <!-- Docket Calls Button -->
    <button class="btn btn-docket" data-page="docket.html" data-title="Docket Calls">
      <i class="fas fa-headset"></i> 
      <span>Docket Calls</span>
    </button>
</div>


<div class="content">
  <div class="report-grid" style="grid-template-columns: 1fr;">
    <div class="report-card">
      <div class="card-header">
        <div class="card-header-left">
          <div class="card-icon connections"><i class="fas fa-user-plus"></i></div>
          <div class="card-title">New Service Connection</div>
        </div>
        <i class="fas fa-chevron-down chevron"></i>
      </div>
      <div class="sub-options">
        <a class="sub-option" data-page="nsc.html" href="#">
          <div class="app-icon connections"><i class="fas fa-chart-bar"></i></div>
          <span class="app-label">Summary</span>
        </a>
        <a class="sub-option" data-page="nsc/kpi.html" href="#">
          <div class="app-icon connections"><i class="fas fa-lightbulb"></i></div>
          <span class="app-label">KPIs</span>
        </a>
        <a class="sub-option" data-page="weekly.html" href="#">
          <div class="app-icon connections"><i class="fas fa-calendar-week"></i></div>
          <span class="app-label">Weekly Deposit vs Disposal</span>
        </a>
        <a class="sub-option" data-page="pending_mc.html" href="#">
          <div class="app-icon connections"><i class="fas fa-credit-card"></i></div>
          <span class="app-label">Pending Master Card</span>
        </a>
        <a class="sub-option" data-page="withheld.html" href="#">
          <div class="app-icon connections"><i class="fas fa-pause-circle"></i></div>
          <span class="app-label">Withheld</span>
        </a>
      </div>
    </div>

    <div class="report-card">
      <div class="card-header">
        <div class="card-header-left">
          <div class="card-icon revenue"><i class="fas fa-rupee-sign"></i></div>
          <div class="card-title">Revenue Reports</div>
        </div>
        <i class="fas fa-chevron-down chevron"></i>
      </div>
      <div class="sub-options">
        <a class="sub-option" data-page="loss.html" href="#">
          <div class="app-icon revenue"><i class="fas fa-chart-area"></i></div>
          <span class="app-label">Losses</span>
        </a>
        <a class="sub-option" data-page="collection.html" href="#">
          <div class="app-icon revenue"><i class="fas fa-cash-register"></i></div>
          <span class="app-label">Collection</span>
        </a>
        <a class="sub-option" data-page="remosd5000.html" href="#">
          <div class="app-icon revenue"><i class="fas fa-rupee-sign"></i></div>
          <span class="app-label">REM OSD >₹5000/-</span>
        </a>
        <a class="sub-option" data-page="rem/defaulters.html" href="#">
          <div class="app-icon revenue"><i class="fas fa-user-times"></i></div>
          <span class="app-label">Defaulters (Class I&C >₹5000/-)</span>
        </a>
        <a class="sub-option" data-page="rem/top200agridom.html" href="#">
          <div class="app-icon revenue"><i class="fas fa-home"></i></div>
          <span class="app-label">TOP 200 Agri-Dom Consumers</span>
        </a>
      </div>
    </div>

    <div class="report-card">
      <div class="card-header">
        <div class="card-header-left">
          <div class="card-icon visits"><i class="fas fa-user-check"></i></div>
          <div class="card-title">DD Visit</div>
        </div>
        <i class="fas fa-chevron-down chevron"></i>
      </div>
      <div class="sub-options">
        <a class="sub-option" data-page="dd/upcomingDD.html" href="#">
          <div class="app-icon visits"><i class="fas fa-calendar-alt"></i></div>
          <span class="app-label">Upcoming DD</span>
        </a>
        <a class="sub-option" data-page="ddbysmdm.html" href="#">
          <div class="app-icon visits"><i class="fas fa-user-tie"></i></div>
          <span class="app-label">Entry by SM/DM</span>
        </a>
        <a class="sub-option" data-page="ddbyro.html" href="#">
          <div class="app-icon visits"><i class="fas fa-user-cog"></i></div>
          <span class="app-label">Entry by RM</span>
        </a>
        <a class="sub-option" data-page="ddsummary.html" href="#">
          <div class="app-icon visits"><i class="fas fa-file-alt"></i></div>
          <span class="app-label">Summary Report</span>
        </a>
      </div>
    </div>

<div class="report-card">
  <div class="card-header">
    <div class="card-header-left">
      <div class="card-icon revenue"><i class="fas fa-bolt"></i></div>
      <div class="card-title">Consumer / Meter Analytics</div>
    </div>
    <i class="fas fa-chevron-down chevron"></i>
  </div>
  <div class="sub-options">
    <a class="sub-option" data-page="consumer/defective_meter.html" href="#">
      <div class="app-icon revenue"><i class="fas fa-exclamation-circle"></i></div>
      <span class="app-label">Defective Meter</span>
    </a>
    <a class="sub-option" data-page="under_construction.html" href="#">
      <div class="app-icon revenue"><i class="fas fa-users"></i></div>
      <span class="app-label">Consumers</span>
    </a>
    <a class="sub-option" data-page="docket.html" href="#">
      <div class="app-icon revenue"><i class="fas fa-headset"></i></div>
      <span class="app-label">Docket Call</span>
    </a>
    <a class="sub-option" data-page="docket/kpi.html" href="#">
      <div class="app-icon revenue"><i class="fas fa-tachometer-alt"></i></div>
      <span class="app-label">Docket KPI</span>
    </a>
  </div>
</div>

    <div class="report-card">
      <div class="card-header">
        <div class="card-header-left">
          <div class="card-icon financial"><i class="fas fa-credit-card"></i></div>
          <div class="card-title">Advance to Vendor</div>
        </div>
        <i class="fas fa-chevron-down chevron"></i>
      </div>
      <div class="sub-options">
        <a class="sub-option" data-page="capex_all.html" href="#">
          <div class="app-icon financial"><i class="fas fa-chart-bar"></i></div>
          <span class="app-label">Capex Summary</span>
        </a>
        <a class="sub-option" data-page="advance_onm.html" href="#">
          <div class="app-icon financial"><i class="fas fa-tools"></i></div>
          <span class="app-label">O&M Summary</span>
        </a>
      </div>
    </div>

<div class="report-card">
  <div class="card-header">
    <div class="card-header-left">
      <div class="card-icon industrial"><i class="fas fa-industry"></i></div>
      <div class="card-title">Substation / Network</div>
    </div>
    <i class="fas fa-chevron-down chevron"></i>
  </div>
  <div class="sub-options">
    <a class="sub-option" data-page="power_map/map.html" href="#">
      <div class="app-icon industrial"><i class="fas fa-map-marked-alt"></i></div>
      <span class="app-label">Power Map</span>
    </a>
    <a class="sub-option" data-page="power_map/nh_sh_crossings.html" href="#">
      <div class="app-icon industrial"><i class="fas fa-road"></i></div>
      <span class="app-label">Electric Line–Highway Crossings</span>
    </a>
    <a class="sub-option" data-page="prt-oil/index.html" href="#">
      <div class="app-icon industrial"><i class="fas fa-industry"></i></div>
      <span class="app-label">PRT/Transformer Records</span>
    </a>


  </div>
</div>

    <!-- New "Important" Group -->
    <div class="report-card">
      <div class="card-header">
        <div class="card-header-left">
          <div class="card-icon priority"><i class="fas fa-star"></i></div>
          <div class="card-title">Important</div>
        </div>
        <i class="fas fa-chevron-down chevron"></i>
      </div>
      <div class="sub-options">
        <!-- CMO Grievance Summary -->
        <a class="sub-option" data-page="cmo.html" href="#">
          <div class="app-icon grievance"><i class="fas fa-exclamation-circle"></i></div>
          <span class="app-label">CMO Grievance</span>
        </a>
        <!-- Priority SI Works Summary -->
        <a class="sub-option" data-page="si-works/si.html" href="#">
          <div class="app-icon priority"><i class="fas fa-diagram-project"></i></div>
          <span class="app-label">Priority SI Works</span>
        </a>
        <!-- JJM Report Summary -->
        <a class="sub-option" data-page="jjm.html" href="#">
          <div class="app-icon water"><i class="fas fa-tint"></i></div>
          <span class="app-label">JJM Report</span>
        </a>
        <!-- Accident Reports -->
        <a class="sub-option" data-page="accident/accident.html" href="#">
          <div class="app-icon safety"><i class="fas fa-exclamation-triangle"></i></div>
          <span class="app-label">Accident Reports</span>
        </a>
        <!-- Safety App Reports -->
        <a class="sub-option" data-page="safety_inspection.html" href="#">
          <div class="app-icon safety"><i class="fas fa-mobile-alt"></i></div>
          <span class="app-label">Safety App Reports</span>
        </a>
        <!-- Manpower Report -->
        <a class="sub-option" data-page="manpower.html" href="#">
          <div class="app-icon civil"><i class="fas fa-users"></i></div>
          <span class="app-label">Manpower Report</span>
        </a>
        <!-- Substation Upkeeping -->
        <a class="sub-option" data-page="Upkeeping/index.html" href="#">
          <div class="app-icon maintenance"><i class="fas fa-tools"></i></div>
          <span class="app-label">Substation Upkeeping</span>
        </a>
        <!-- DTR Records -->
        <a class="sub-option" data-page="dtr/index.html" href="#">
          <div class="app-icon maintenance"><i class="fas fa-clipboard-list"></i></div>
          <span class="app-label">DTR Records</span>
        </a>
        <!-- Peak Load Measurements -->
        <a class="sub-option" data-page="dtr/load.html" href="#">
          <div class="app-icon maintenance"><i class="fas fa-chart-area"></i></div>
          <span class="app-label">Peak Load Measurements</span>
        </a>
        <!-- Health Check-up -->
        <a class="sub-option" data-page="health_checkup.html" href="#">
          <div class="app-icon maintenance"><i class="fas fa-heartbeat"></i></div>
          <span class="app-label">Health Check-up</span>
        </a>
      </div>
    </div>


        <!-- Tools -->
<div class="report-card">
  <div class="card-header">
    <div class="card-header-left">
      <div class="card-icon safety"><i class="fas fa-tools"></i></div>
      <div class="card-title">Tools</div>
    </div>
    <i class="fas fa-chevron-down chevron"></i>
  </div>
  <div class="sub-options">
    <a class="sub-option" data-page="under_construction.html" href="#">
      <div class="app-icon safety"><i class="fas fa-project-diagram"></i></div>
      <span class="app-label">Easy SLD</span>
    </a>
    <a class="sub-option" data-page="under_construction.html" href="#">
      <div class="app-icon safety"><i class="fas fa-file-invoice-dollar"></i></div>
      <span class="app-label">Estimate Generator</span>
    </a>
  </div>
</div>


    <!-- Media Report Card (Place inside .report-grid) -->
<div class="report-card">
  <div class="card-header">
    <div class="card-header-left">
      <div class="card-icon solar"><i class="fas fa-newspaper"></i></div>
      <div class="card-title">Media Corner</div>
    </div>
    <i class="fas fa-chevron-down chevron"></i>
  </div>
  <div class="sub-options" id="mediaLinksContainer">
    <a class="sub-option" data-page="https://www.uttarbangasambad.in/malda.php" href="#">
        <div class="app-icon solar">
          <img src="data/logo/uttarbanga.png" alt="Uttarbanga Sambad" style="width: 28px; height: 28px; border-radius: 4px; object-fit: cover;">
        </div>
        <span class="app-label">উত্তরবঙ্গ পত্রিকা</span>
    </a>
    <a class="sub-option" data-page="https://www.anandabazar.com/west-bengal/north-bengal" href="#">
        <div class="app-icon solar">
          <img src="data/logo/abp.png" alt="Anandabazar Patrika" style="width: 28px; height: 28px; border-radius: 4px; object-fit: cover;">
        </div>
        <span class="app-label">আনন্দবাজার পত্রিকা</span>
    </a>
  </div>
</div>

  </div>
 
</div>


<div class="footer">
      © 2025 MZO | Think outside the box
    </div>
</div></div>
<div class="page" id="detailPage">
<div class="header">
<div style="display: flex; align-items: center;">
<button class="back-button" id="backButton">
<i class="fas fa-arrow-left"></i>
</button>
<h1 class="main-title" style="font-size: 20px;">Page Title</h1>
</div>
<button class="refresh-icon" id="iframeRefreshBtn">
<i class="fas fa-sync-alt"></i>
</button>
</div>

   
<div id="iframeWrapper" style="height: calc(100vh - 56px); overflow-y: auto; -webkit-overflow-scrolling: touch;">
  <div id="pullToRefresh" style="display: none; text-align: center; padding: 10px; color: var(--text-secondary); font-weight: 500; font-size: 14px;">
    🔄 Refreshing...
  </div>
  <iframe id="subPageFrame" src="" style="width: 100%; height: calc(100vh - 96px); border: none; background-color: var(--bg-dark);"></iframe>
</div>


<div id="iframeError" style="
  display: none;
  position: absolute;
  top: 70px; /* Adjusted for new header height */
  left: 0;
  width: 100%;
  height: calc(100% - 70px);
  background: var(--bg-dark);
  color: var(--text-secondary);
  font-size: 15px;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 16px;
  z-index: 10;
">
  🚫 Failed to load the page. Please check your internet connection or try again later.
</div>
   
</div></div></div></div>

<div class="loading-overlay" id="loadingOverlay"></div>

<!-- Sheets list modal (added) -->
<div id="sheetsModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:10000; align-items:center; justify-content:center; padding:16px;">
  <div style="width:100%; max-width:520px; background:#fff; border-radius:12px; padding:0; box-shadow:0 10px 30px rgba(0,0,0,0.2); position:relative; overflow:hidden;">
    <!-- NAVBAR: keep same back-arrow navbar used on other pages -->
    <div class="header" style="position:relative; padding:12px 16px; background: #f8fafc; color:#0f172a; border-bottom:1px solid #e6e6e6;">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
        <div style="display:flex; align-items:center; gap:12px;">
          <button class="back-button" id="closeSheetsModalBtn" title="Back" style="color:#0f172a; background:none; border:none; padding:6px;">
            <i class="fas fa-arrow-left"></i>
          </button>
          <div style="display:flex; flex-direction:column;">
            <div style="font-weight:700; font-size:16px;">Puja 2025</div>
            <div style="font-size:12px; color:#6b7280;">Quick Sheets</div>
          </div>
        </div> 

        <!-- optional small refresh icon for modal (keeps same look as other pages) -->
        <button class="refresh-icon" onclick="document.getElementById('sheetsModal').querySelector('a').focus()" title="Focus first link" style="width:36px; height:36px;">
          <i class="fas fa-sync-alt"></i>
        </button>
      </div>
    </div>

    <div style="padding:18px 16px 20px;">
      <p style="margin:0 0 12px; color:#4b5563; font-size:14px;">Open the required Google Sheet in a new tab.</p>

      <div style="display:grid; gap:10px;">
        <a class="btn btn-kpi" href="https://docs.google.com/spreadsheets/d/1lkQlOv4sWzSTIOKAkem-oJmEvA7RNTLT0w-tsKi-_kI/edit?gid=0#gid=0" target="_blank" rel="noopener noreferrer" style="justify-content:flex-start;">
          <i class="fas fa-bolt" style="width:22px;text-align:center;"></i>
          <span style="margin-left:8px;">Daily Peak Loading</span>
        </a>

        <a class="btn btn-kpi" href="https://docs.google.com/spreadsheets/d/1EGhWifLAYcnX6ZKVxPxtpxafdCrk_ueR67ObR9vDUM8/edit?gid=0#gid=0" target="_blank" rel="noopener noreferrer" style="justify-content:flex-start;">
          <i class="fas fa-gift" style="width:22px;text-align:center;"></i>
          <span style="margin-left:8px;">Puja Report Format-I</span>
        </a>

        <a class="btn btn-kpi" href="https://docs.google.com/spreadsheets/d/1Jh5-C7HXNoByxaGvzb8kBku1ov_HqwDS_wID-sS85Pk/edit?gid=0#gid=0" target="_blank" rel="noopener noreferrer" style="justify-content:flex-start;">
          <i class="fas fa-file-alt" style="width:22px;text-align:center;"></i>
          <span style="margin-left:8px;">Puja Report Format-II</span>
        </a>
      </div>

      <div style="margin-top:18px; text-align:right;">
        <button id="closeSheetsModalBtn2" style="background:#e5e7eb; color:#111827; border:none; padding:10px 14px; border-radius:8px; cursor:pointer;">Close</button>
      </div>
    </div>
  </div>
</div>


<script>
// ──────────────────────────────────────
//   Theme Toggling
// ──────────────────────────────────────
const themeToggleButton = document.getElementById('themeToggleBtn');
const themeIcon = themeToggleButton.querySelector('i');
const body = document.body;

function applyTheme(theme) {
  if (theme === 'light') {
    body.classList.add('light-theme');
    body.classList.remove('dark-theme');
    themeIcon.classList.remove('fa-sun');
    themeIcon.classList.add('fa-moon');
    localStorage.setItem('theme', 'light');
  } else {
    body.classList.add('dark-theme');
    body.classList.remove('light-theme');
    themeIcon.classList.remove('fa-moon');
    themeIcon.classList.add('fa-sun');
    localStorage.setItem('theme', 'dark');
  }
}

function toggleTheme() {
  const currentTheme = localStorage.getItem('theme') || 'dark';
  const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
  applyTheme(newTheme);
}

// Apply saved theme on initial load
const savedTheme = localStorage.getItem('theme') || 'dark'; // Default to dark
applyTheme(savedTheme);
</script>
<script>

// Refresh functions
// Refresh functions
function refreshMainPage() {
  console.log('Main page refresh clicked');
  const refreshBtn = document.getElementById('mainRefreshBtn');
  const overlay = document.getElementById('loadingOverlay');
  
  if (refreshBtn) {
    refreshBtn.classList.add('spinning');
    console.log('Added spinning class to main refresh');
  }
  if (overlay) {
    overlay.classList.add('active');
  }
  
  setTimeout(() => {
    window.location.reload();
  }, 800);
}

function refreshIframe() {
  const refreshBtn = document.getElementById('iframeRefreshBtn');
  const iframe = document.getElementById('subPageFrame');
  const overlay = document.getElementById('loadingOverlay');
  const errorDiv = document.getElementById('iframeError');

  if (refreshBtn) refreshBtn.classList.add('spinning');
  if (overlay) overlay.classList.add('active');
  if (errorDiv) errorDiv.style.display = 'none';

  if (iframe && iframe.src) {
    const currentSrc = iframe.src;
    // Fix: Just reload with cache-busting
    iframe.src = currentSrc + (currentSrc.includes('?') ? '&' : '?') + 't=' + Date.now();
  }

  setTimeout(() => {
    if (refreshBtn) refreshBtn.classList.remove('spinning');
    if (overlay) overlay.classList.remove('active');
  }, 2000);
}


// Make functions globally available
window.refreshMainPage = refreshMainPage;
window.refreshIframe = refreshIframe;


// Android-style navigation
function openPage(page, title) {
  const iframe = document.getElementById("subPageFrame");
  const errorDiv = document.getElementById("iframeError");
  const loader = document.getElementById("iframeLoader");
  const desktopBreakpoint = 768; // Define your desktop breakpoint

  if (window.innerWidth >= desktopBreakpoint) {
    // Open in new tab for desktop
    window.open(page, '_blank');
    return; // Exit function, no need to proceed with iframe logic
  }

  // Hide any previous error
  if (loader) loader.classList.add('active');
  if (iframe) iframe.classList.add('loading');


  errorDiv.style.display = "none";

  // Temporarily remove previous event listener
  iframe.onload = null;
  iframe.onerror = null;

  // Show loading state and set the new src
  iframe.src = "";
  iframe.src = page;
  document.querySelector("#detailPage .main-title").textContent = title;

  document.getElementById("mainPage").classList.remove("active");
  document.getElementById("detailPage").classList.add("active");

  let loadFailed = false;

const timeout = setTimeout(() => {
  try {
    const doc = iframe.contentDocument || iframe.contentWindow.document;
    const title = (doc.title || "").toLowerCase();
    const body = (doc.body && doc.body.innerText || "").toLowerCase();

    // Try to infer 404
    if (title.includes("404") || title.includes("not found") || body.includes("404") || body.includes("not found")) {
      showIframeError("🚫 Page Not Found (404). This file might be missing.");
      return;
    }

    // Check for empty/blank load (often a network failure)
    if (!body.trim() || body.trim().length < 20) {
      showIframeError("🛑 Unable to load. Network might be unstable.");
      return;
    }

    // Generic fallback
    showIframeError("⚠️ Something went wrong. Please try again.");
  } catch (err) {
    // Catch iframe load failure (possibly network)
    showIframeError("🛑 Network issue or unreachable content.");
  }
}, 4000);


function showIframeError(message) {
  const errorDiv = document.getElementById("iframeError");
  errorDiv.innerHTML = `${message}<br/><br/> 
    <button onclick="retryIframe()" style="background: var(--danger); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">🔄 Retry</button>`;
  errorDiv.style.display = "flex";
}

function retryIframe() {
  const iframe = document.getElementById("subPageFrame");
  const errorDiv = document.getElementById("iframeError");
  const currentSrc = iframe.src;
  errorDiv.style.display = "none";
  iframe.src = "";
  setTimeout(() => {
    iframe.src = currentSrc;
  }, 150);
}

  // If iframe loads successfully, cancel timeout
  iframe.onload = () => {
    clearTimeout(timeout);
    if (loader) loader.classList.remove('active');
    if (iframe) iframe.classList.remove('loading');
    errorDiv.style.display = "none";
  };

  // Catch iframe load error (rarely works in some browsers)
  iframe.onerror = () => {
    clearTimeout(timeout);
    if (loader) loader.classList.remove('active');
    if (iframe) iframe.classList.remove('loading');
    errorDiv.style.display = "flex";
  };
}


function goBack() {
  document.getElementById("detailPage").classList.remove("active");
  document.getElementById("mainPage").classList.add("active");
  document.getElementById("subPageFrame").src = "";
  // Ensure loader is hidden when going back
  document.getElementById("iframeLoader")?.classList.remove('active');
}

// Configuration
const scriptURL = "https://script.google.com/macros/s/AKfycbxDplwAiaxSMzMjRDLsmGQ5A01MQcvqMLT9B5imoRFh7XEWYgBqtRc63bUALKPXuu7jlA/exec";


// Report card toggle function
function toggleSub(card) {
  // Accordion functionality is removed for the new design.
  // The sub-options are always visible.
  // This function is kept to prevent errors from the inline `onclick` attributes,
  // but it does nothing. The `onclick` attributes can be removed from the HTML
  // for cleanup.
  return;
}

// Connectivity check
function checkConnectivity() {
  const errorBanner = document.getElementById('errorBanner');
  if (!navigator.onLine) {
    errorBanner.style.display = 'block';
  } else {
    errorBanner.style.display = 'none';
  }
}

// Event listeners - wait for DOM to load
document.addEventListener('DOMContentLoaded', function() {
  console.log("DOM loaded"); // Debug log

  // --- Refactored Event Listeners ---
  document.getElementById('themeToggleBtn')?.addEventListener('click', toggleTheme);
  document.getElementById('mainRefreshBtn')?.addEventListener('click', refreshMainPage);
  document.getElementById('iframeRefreshBtn')?.addEventListener('click', refreshIframe);
  document.getElementById('backButton')?.addEventListener('click', goBack);

  // Docket Calls button
  document.querySelector('.btn-docket')?.addEventListener('click', function() {
    openPage(this.dataset.page, this.dataset.title);
  });

  // All sub-option links
  document.querySelectorAll('.sub-option').forEach(link => {
    link.addEventListener('click', function(e) {
      if (this.getAttribute('target') === '_blank') {
        return; // Allow default behavior for new tabs
      }
      e.preventDefault();
      const page = this.getAttribute('data-page');
      const title = this.querySelector('.app-label')?.textContent.trim() || 'Details';
      if (page) {
        openPage(page, title);
      }
    });
  });

  // --- End Refactored Event Listeners ---

  // Re-apply theme to ensure correct icon state after all scripts load
  applyTheme(localStorage.getItem('theme') || 'dark');

  // Connectivity checks
  checkConnectivity();
  window.addEventListener('online', checkConnectivity);
  window.addEventListener('offline', checkConnectivity);

  // --- Motivational Quotes Logic ---
  const quotes = [
    "Safety isn't a slogan, it's a way of life. Plan your work, work your plan.",
    "The strength of the team is each individual member. The strength of each member is the team.",
    "Quality is not an act, it is a habit. Do it right when no one is looking.",
    "A successful project is built on a foundation of clear communication and meticulous planning.",
    "The best way to predict the future is to create it. Engineer the change you want to see.",
    "There are no shortcuts to any place worth going. Precision and patience build lasting infrastructure.",
    "Good engineering is not about being perfect, but about being effective and efficient.",
    "The expert in anything was once a beginner. Keep learning, keep growing.",
    "Measure twice, cut once. In our world, it's 'Check twice, energize once.'",
    "Challenges are what make life interesting; overcoming them is what makes life meaningful.",
    "Your attention to detail today prevents an outage tomorrow.",
    "A problem is a chance for you to do your best. Find the solution.",
    "Don't watch the clock; do what it does. Keep going.",
    "The only way to do great work is to love what you do."
  ];

  const leftQuoteContainer = document.getElementById('leftQuoteContainer');
  const rightQuoteContainer = document.getElementById('rightQuoteContainer');
  let currentQuoteIndex = 0;
  let activeContainer = 'left'; // Start with the left container

  function showNextQuote() {
    // Fade out both containers
    leftQuoteContainer.style.opacity = 0;
    rightQuoteContainer.style.opacity = 0;

    // Wait for fade-out to complete
    setTimeout(() => {
      // Update the content of the next active container
      const quote = `“${quotes[currentQuoteIndex]}”`;
      if (activeContainer === 'left') {
        leftQuoteContainer.textContent = quote;
        rightQuoteContainer.textContent = ''; // Clear the other one
      } else {
        rightQuoteContainer.textContent = quote;
        leftQuoteContainer.textContent = ''; // Clear the other one
      }

      // Fade in the active container
      if (activeContainer === 'left') {
        leftQuoteContainer.style.opacity = 0.6;
      } else {
        rightQuoteContainer.style.opacity = 0.6;
      }

      // Prepare for the next cycle
      currentQuoteIndex = (currentQuoteIndex + 1) % quotes.length;
      activeContainer = (activeContainer === 'left') ? 'right' : 'left';
    }, 1500); // This delay should match the CSS transition duration
  }

  // Always run the quote rotation. CSS will handle visibility based on screen width.
  showNextQuote(); // Show the first quote immediately
  setInterval(showNextQuote, 45000); // Change quote every 45 seconds
  
  // Add touch feedback for report cards
  document.querySelectorAll('.sub-option').forEach(card => {
    card.addEventListener('touchstart', function() {
      this.style.transform = 'scale(0.97)';
    });
    
    card.addEventListener('touchend', function() {
      setTimeout(() => {
        this.style.transform = '';
      }, 100);
    });
  });
});

   // Pull-to-refresh for iframe
(function() {
  const wrapper = document.getElementById("iframeWrapper");
  const iframe = document.getElementById("subPageFrame");
  const pullToRefresh = document.getElementById("pullToRefresh");

  let startY = 0;
  let isPulling = false;

  wrapper.addEventListener('touchstart', function(e) {
    if (wrapper.scrollTop === 0) {
      startY = e.touches[0].clientY;
      isPulling = true;
    }
  });

  wrapper.addEventListener('touchmove', function(e) {
    if (!isPulling) return;

    const distance = e.touches[0].clientY - startY;
    if (distance > 60) {
      pullToRefresh.style.display = "block";
    }
  });

  wrapper.addEventListener('touchend', function() {
    if (pullToRefresh.style.display === "block") {
      const src = iframe.src;
      iframe.src = "";
      setTimeout(() => {
        iframe.src = src;
        pullToRefresh.style.display = "none";
      }, 150);
    }
    isPulling = false;
  });
})();

// Sheets modal controls (added)
function openSheetsModal() {
  const modal = document.getElementById('sheetsModal');
  if (!modal) return;
  modal.style.display = 'flex';
  document.body.style.overflow = 'hidden';
  // focus for accessibility
  const firstLink = modal.querySelector('a, button');
  if (firstLink) firstLink.focus();
}
function closeSheetsModal() {
  console.log("Closing sheets modal");
  const modal = document.getElementById('sheetsModal');
  if (!modal) return;
  modal.style.display = 'none';
  document.body.style.overflow = '';
  
}

// Close modal when clicking backdrop
document.addEventListener('click', function (e) {
  const modal = document.getElementById('sheetsModal');
  if (!modal) return;
  if (modal.style.display === 'flex' && e.target === modal) {
    closeSheetsModal();
  }
});

// Close modal on Escape
document.addEventListener('keydown', function (e) {
  if (e.key === 'Escape') {
    const modal = document.getElementById('sheetsModal');
    if (modal && modal.style.display === 'flex') closeSheetsModal();
  }
});

// expose to global scope for inline onclick handlers
document.addEventListener('DOMContentLoaded', () => {
    // No need to expose to window if we use event listeners
    document.getElementById('closeSheetsModalBtn')?.addEventListener('click', closeSheetsModal);
    document.getElementById('closeSheetsModalBtn2')?.addEventListener('click', closeSheetsModal);
});

// ...existing code...
</script>

<!-- Single Responsive Modal with Quote and Dynamic Notice -->
<div id="noticeModal">
  <div>
    <!-- Motivational quote section (initially shown) -->
    <div id="quoteSection">
      <span id="typedQuote"></span>
    </div>

    <!-- Smart Forward Button -->
    <div id="forwardButtonContainer">
        <button id="smartForwardBtn" onclick="skipToNotice()" title="Skip intro">
            <i class="fas fa-arrow-right"></i>
        </button>
    </div>

    <!-- Notice content (hidden until data is loaded) -->
    <div id="noticeContentSection">
      <h2 id="noticeTitle"></h2>
      <div id="noticeBody"></div>
    </div>

    <!-- Button appears only after content loads -->
    <div id="noticeButtonSection">
      <button onclick="onContinueClick()">
        Continue
      </button>
    </div>
  </div>
</div>


<script>
window.addEventListener("DOMContentLoaded", () => {
  const baseUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSiBAAv6fTB3Yd6yWMc3O3w3nplfaNyI1FR9S570KaXehdG4sPjakxctFqRaY4vh1_hs6i3D-ej216W/pub?gid=0&single=true&output=csv";

  let csvLoaded = false;
  let rows = [];
  let currentIndex = 0;
  let skipRequested = false;
const quotes = [
  "We don’t just restore power—we build trust."
];
  const quoteText = quotes[Math.floor(Math.random() * quotes.length)]; // The quote to be animated
  const typedQuoteElement = document.getElementById("typedQuote");

  function animateQuote() {
    const words = quoteText.split(' ');
    // Wrap each word in a span with a staggered animation delay
    typedQuoteElement.innerHTML = words.map((word, index) => 
      `<span class="quote-word" style="animation-delay: ${index * 0.12}s;">${word}</span>`
    ).join(' ');

  }
  function showNoticeIfReady() {
    if (skipRequested && csvLoaded) {
      document.getElementById("quoteSection").style.display = "none";
      document.getElementById("forwardButtonContainer").style.display = "none";
      document.getElementById("noticeContentSection").style.display = "block";
      document.getElementById("noticeButtonSection").style.display = "block";
      showRow(currentIndex);
    }
  }

function showRow(index) {
  const row = rows[index];
  if (!row) return;

  const titleElem = document.getElementById("noticeTitle");
  const bodyElem = document.getElementById("noticeBody");

  titleElem.textContent = row.header || "Notice";
  bodyElem.textContent = row.content || "No content.";

  // Apply red color to header only if it contains 'Alert!'
  if ((row.header || "").toLowerCase().includes("alert!")) {
    titleElem.style.color = "#dc2626"; // A strong red for alerts on a light background
  } else {
    titleElem.style.color = ""; // Revert to stylesheet color
  }

  // Body color is controlled by stylesheet, no need to set it here.
  bodyElem.style.color = "";
}

  window.skipToNotice = () => {
    skipRequested = true;
    const forwardBtn = document.getElementById('smartForwardBtn');
    if (forwardBtn) {
      forwardBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
      forwardBtn.disabled = true;
    }
    showNoticeIfReady(); // Attempt to show, will work if csv is already loaded.
  };



  window.onContinueClick = () => {
    currentIndex++;
    if (currentIndex >= rows.length) {
      document.getElementById("noticeModal").style.display = "none";
      startCardAnimation(); // Trigger card animation
    } else {
      showRow(currentIndex);
    }
  };

  // Start animating the quote
  animateQuote();

  // Function to start card animations
  function startCardAnimation() {
    const cards = document.querySelectorAll('.report-card');
    cards.forEach((card, index) => {
      card.style.animationDelay = `${index * 75}ms`;
      card.classList.add('start-animation');
    });
  }

  // Fetch CSV with cache busting
  const csvUrl = `${baseUrl}&t=${Date.now()}`;
fetch(`${csvUrl}`)
  .then(res => res.text())
  .then(csv => {
    const parsed = Papa.parse(csv, { header: true }).data;

    parsed.forEach(row => {
      rows.push({
        header: (row["Header"] || "").trim(),
        content: (row["Content"] || "").trim()
      });
    });

    csvLoaded = true;
    showNoticeIfReady();
  })
  .catch(err => {
    console.error("Failed to load notice from CSV:", err);
    rows = [{ header: "Notice", content: "⚠️ Could not load notice content." }];
    csvLoaded = true;
    showNoticeIfReady();
  });

});
</script>

</body>
</html>
