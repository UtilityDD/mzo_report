<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MOM Generator</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
  <style>
    /* General Body and Container Styles */
    body {
      font-family: sans-serif; /* Reverted to sans-serif */
      background: #f3f4f6;
      margin: 0;
      padding: 1rem;
      line-height: 1.6;
      color: #333;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .header {
      text-align: center;
      margin-bottom: 2rem;
    }
    .header h1 {
      color: #2563eb;
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }
    .header h1 i {
      margin-right: 10px;
    }

    /* Tabs Styling */
    .tabs-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: flex-start;
      margin-bottom: 1.5rem;
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 0.5rem;
      gap: 10px;
    }
    .tab {
      padding: 0.75rem 1.2rem;
      border: 1px solid #ccc;
      border-bottom: none;
      border-radius: 8px 8px 0 0;
      cursor: pointer;
      background-color: #f0f0f0;
      color: #555;
      font-weight: bold;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      font-size: 0.85rem;
      box-shadow: 0 -2px 5px rgba(0,0,0,0.05);
      min-width: 120px;
      box-sizing: border-box;
    }
    .tab:hover {
      background-color: #e6e6e6;
      color: #333;
    }
    .tab.active {
      background-color: #2563eb;
      color: white;
      border-color: #2563eb;
      border-bottom: 2px solid #2563eb;
      transform: translateY(2px);
      box-shadow: 0 0 10px rgba(37,99,235,0.3);
    }
    .tab-title {
      font-size: 1em;
      margin-bottom: 0.25rem;
    }
    .tab-data {
      font-size: 0.8em;
      font-weight: normal;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }

    /* Form Step Styling */
    .form-step {
      opacity: 0;
      max-height: 0;
      overflow: hidden;
      transform: translateY(20px);
      transition: all 0.6s ease;
      margin-bottom: 1.5rem;
      border: 1px solid #e0e0e0;
      padding: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .form-step.visible {
      opacity: 1;
      max-height: 800px; /* Adjust as needed for content */
      transform: translateY(0);
    }
    .form-step.hidden {
      display: none;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    input, textarea, select {
      padding: 0.75rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      width: calc(100% - 1.5rem); /* Account for padding */
      box-sizing: border-box; /* Include padding in width */
    }
    textarea {
      resize: vertical;
    }
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #eee;
    }
    .section-header h3 {
      margin: 0;
      color: #333;
    }
    .btn {
      background: #2563eb;
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }
    .btn:hover {
      background-color: #1a4ed8;
      transform: translateY(-1px);
    }
    .btn:active {
      transform: translateY(0);
    }
    .btn:disabled {
      background-color: #a0aec0;
      cursor: not-allowed;
    }
    .item-container {
      margin-top: 1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .item-container .form-group {
      margin-bottom: 0;
      border: 1px dashed #e0e0e0;
      padding: 0.75rem;
      border-radius: 5px;
      background-color: #fafafa;
    }
    .navigation-buttons {
      text-align: right;
      margin-top: 2rem;
    }
    .navigation-buttons .btn {
      margin-left: 1rem;
    }

    /* Assignee/Attendee Tagging Styles */
    .assignees-input-area, .attendees-input-area {
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 0.5rem;
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .assignees-tags-container, .attendees-tags-container {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    .assignee-tag, .attendee-tag {
      background-color: #e0e7ff;
      color: #2563eb;
      padding: 0.3rem 0.6rem;
      border-radius: 4px;
      display: flex;
      align-items: center;
      font-size: 0.9em;
    }
    .assignee-remove-btn, .attendee-remove-btn {
      background: none;
      border: none;
      color: #2563eb;
      font-weight: bold;
      margin-left: 5px;
      cursor: pointer;
      font-size: 0.8em;
      padding: 0;
    }
    .assignee-remove-btn:hover, .attendee-remove-btn:hover {
      color: #a00;
    }
    .assignee-input-field, .attendee-input-field {
      flex-grow: 1;
      border: none;
      padding: 0.25rem;
      min-width: 100px;
    }
    .assignee-input-field:focus, .attendee-input-field:focus {
      outline: none;
    }

    /* Task Item Styles */
    .task-item {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        margin-bottom: 1rem;
        overflow: hidden;
        transition: all 0.6s ease;
    }
    .task-header {
        background-color: #f8f8f8;
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        font-weight: bold;
        color: #333;
    }
    .task-header h3 {
        margin: 0;
        font-size: 1rem;
    }
    .task-header .toggle-btn {
        background: none;
        border: none;
        font-size: 1.2rem;
        cursor: pointer;
        transition: transform 0.3s ease;
    }
    .task-header .toggle-btn i {
        transition: transform 0.3s ease;
    }
    .task-header .toggle-btn i.fa-chevron-up {
        transform: rotate(180deg);
    }
    .task-details-content {
        max-height: 500px;
        overflow: hidden;
        transition: max-height 0.6s ease;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }
    .task-item.collapsed .task-details-content {
        max-height: 0;
        padding: 0 1rem;
    }
    .task-item.collapsed .task-details-content .form-group {
        padding: 0;
    }

    /* Autocomplete Styles */
    .autocomplete-wrapper {
      position: relative;
    }
    .autocomplete-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      border: 1px solid #ccc;
      background: #fff;
      z-index: 10;
      max-height: 150px;
      overflow-y: auto;
      display: none;
      border-radius: 0 0 5px 5px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .autocomplete-suggestions div {
      padding: 8px;
      cursor: pointer;
    }
    .autocomplete-suggestions div:hover {
      background-color: #f0f0f0;
    }

    /* MOM Modal Styles */
    .mom-modal {
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
      transition: opacity 0.3s ease;
    }
    .mom-modal.hidden {
      opacity: 0;
      pointer-events: none;
    }
    .mom-modal-content {
      background-color: #fefefe;
      margin: auto;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      width: 80%;
      max-width: 900px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      transform: translateY(-20px);
      transition: transform 0.3s ease;
    }
    .mom-modal.hidden .mom-modal-content {
      transform: translateY(-50px);
    }
    .close-button {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      position: absolute;
      top: 10px;
      right: 20px;
      cursor: pointer;
      transition: color 0.3s ease;
    }
    .close-button:hover,
    .close-button:focus {
      color: #333;
      text-decoration: none;
    }

.mom-output {
  font-family: sans-serif;
  line-height: 1.4;
  color: #333;
  padding-top: 10px;
  font-size: 0.9rem;
}
.mom-output h2 {
  text-align: center;
  color: #2563eb;
  margin-bottom: 1rem;
  font-size: 1.2rem;
  border-bottom: 1px solid #ccc;
  padding-bottom: 0.3rem;
}
.mom-output h3 {
  color: #1a4ed8;
  margin-top: 1rem;
  margin-bottom: 0.5rem;
  font-size: 1rem;
}
.mom-output p {
  margin-bottom: 0.3rem;
}
.mom-output ul,
.mom-output ol {
  margin-left: 1.2rem;
  margin-bottom: 0.8rem;
  padding-left: 1rem;
}
.mom-output ul li,
.mom-output ol li {
  margin-bottom: 0.3rem;
}
.mom-output .mom-section {
  margin-bottom: 1rem;
  padding: 0.6rem;
  border: 1px solid #eee;
  border-radius: 5px;
  background-color: #f9f9f9;
}
.mom-output .mom-section strong {
  color: #000;
}
.mom-output .action-item-details {
  font-size: 0.8em;
  font-style: italic;
  color: #555;
  margin-top: 0.15em;
  margin-left: 1.2em;
  display: block;
}
.mom-output table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 0.5rem;
  margin-bottom: 1rem;
  font-size: 0.85rem;
}
.mom-output th,
.mom-output td {
  border: 1px solid #ddd;
  padding: 6px;
  text-align: left;
}
.mom-output th {
  background-color: #e6e6e6;
  font-weight: bold;
  color: #555;
}
.mom-output tr:nth-child(even) {
  background-color: #f2f2f2;
}


    /* Custom Message Box for Alerts */
    #customMessageBox {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #2563eb;
      color: white;
      padding: 15px 25px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      z-index: 1001;
      opacity: 0;
      transition: opacity 0.3s ease-in-out;
      font-family: sans-serif;
      font-size: 1rem;
    }

    /* Print specific styles */
    @media print {
      body {
        background: white;
      }
      .container, .tabs-container, .form-step, .navigation-buttons, .mom-actions, .close-button, #customMessageBox {
        display: none !important;
      }
      .mom-modal {
        position: static;
        display: block;
        background: white;
        width: auto;
        height: auto;
        overflow: visible;
      }
      .mom-modal-content {
        width: auto;
        max-width: none;
        max-height: none;
        overflow: visible;
        box-shadow: none;
        padding: 0;
        margin: 0;
        transform: none;
      }
      .mom-output {
        padding: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1><i class="fas fa-clipboard-list"></i> Minutes of Meetings</h1>
    </div>

    <div class="tabs-container" id="tabsContainer">
      <!-- Tabs will be dynamically inserted here by JavaScript -->
    </div>

    <div class="form-content-area">
      <div class="form-step" id="step1">
        <div class="section-header">
          <h3>Meeting Title</h3>
        </div>
        <div class="form-group">
          <input type="text" id="meetingName" placeholder="Meeting Title" list="meetingTitles"/>
          <datalist id="meetingTitles">
            <option value="ZM PRT Meeting">
            <option value="Review Meeting on various operational parameters">
            <option value="Review meeting on revenue activities">
            <option value="Review meeting on disconnection activities">
            <option value="Review meeting on CMO grievance">
          </datalist>
        </div>
        <div class="navigation-buttons">
          <button class="btn" onclick="saveAndNext(1)">Save & Next</button>
        </div>
      </div>

      <div class="form-step" id="step2">
        <div class="section-header">
          <h3>Date & Time</h3>
        </div>
        <div class="form-group">
          <input type="datetime-local" id="meetingDate" placeholder="Meeting Date & Time"/>
        </div>
        <div class="navigation-buttons">
          <button class="btn" onclick="saveAndNext(2)">Save & Next</button>
        </div>
      </div>

      <div class="form-step" id="step3">
        <div class="section-header">
          <h3>Meeting Venue</h3>
        </div>
        <div class="form-group">
          <input type="text" id="meetingLocation" placeholder="Meeting Venue" list="meetingLocations"/>
          <datalist id="meetingLocations">
            <option value="WBSEDCL IB, Malda">
            <option value="WBSEDCL IB Dakshin Dinajpur">
            <option value="WBSETCL IB, Uttar Dinajpur">
            <option value="WBSEDCL Administrative Building, Uttar Dinajpur">
            <option value="Zonal Office, Malda">
          </datalist>
        </div>
        <div class="navigation-buttons">
          <button class="btn" onclick="saveAndNext(3)">Save & Next</button>
        </div>
      </div>

      <div class="form-step" id="step4">
        <div class="section-header">
          <h3>Attendees</h3>
          <button class="btn" onclick="addAttendee()">+ Add</button>
        </div>
        <div id="attendeesContainer" class="item-container"></div>
        <div class="navigation-buttons">
          <button class="btn" onclick="saveAndNext(4)">Save & Next</button>
        </div>
      </div>

      <div class="form-step" id="step5">
        <div class="section-header">
          <h3>New Assignments</h3>
          <button class="btn" id="addTaskBtn" onclick="addTask()">+ Add Task</button>
        </div>
        <div id="tasksContainer" class="item-container"></div>
        <div class="navigation-buttons">
          <button class="btn" onclick="saveAndNext(5)">Save & Next</button>
        </div>
      </div>

      <div class="form-step" id="step6">
        <div class="section-header">
          <h3>Agenda</h3>
        </div>
        <div class="form-group">
          <div class="autocomplete-wrapper">
            <textarea id="agenda" rows="4" placeholder="Review of last meeting's assignments" autocomplete="off"></textarea>
            <div class="autocomplete-suggestions"></div>
          </div>
        </div>
        <div class="navigation-buttons">
          <button class="btn" onclick="saveAndNext(6)">Save & Next</button>
        </div>
      </div>

      <div class="form-step" id="step7">
        <div class="section-header">
          <h3>Next Steps / Other Discussions</h3>
        </div>
        <div class="form-group">
          <div class="autocomplete-wrapper">
            <textarea id="nextSteps" rows="3" placeholder="Other important discussions" autocomplete="off"></textarea>
            <div class="autocomplete-suggestions"></div>
          </div>
        </div>
        <div class="navigation-buttons">
          <button class="btn" onclick="generateMOM()">Generate MOM</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Datalists for Autocomplete Suggestions -->
  <datalist id="assignedToSuggestions">
    <option value="SM">
    <option value="DM">
    <option value="RM">
    <option value="AE/DE(Tech)">
    <option value="Manager (HR&A)">
    <option value="Manager (F&A)">
    <option value="AE/DE-IT">
    <option value="DE/SE(Commerce)">
    <option value="AE/DE (S&LP)">
    <option value="AM(HR&A)">
    <option value="AM(F&A)">
  </datalist>

  <datalist id="taskDescriptionSuggestions">
    <option value="Disconnection Drive">
    <option value="OSD Collection">
    <option value="Revenue Collection">
    <option value="S&LP Cases Review">
    <option value="Court Cases Status">
    <option value="AT&C Loss Analysis">
    <option value="T&D Loss Reduction">
    <option value="Demand Side Management">
    <option value="Collection Performance">
    <option value="Input Energy Audit">
    <option value="Physical Disconnection Enforcement">
    <option value="New Service Connections Processing">
    <option value="Accident Report Preparation">
    <option value="Bulk Connection Survey">
    <option value="Priority SI Works Status">
    <option value="Long Pending NSC Clearance">
    <option value="Commercial Consumer Review">
    <option value="Industrial Consumer Review">
    <option value="Agriculture Feeder Monitoring">
    <option value="STW Compliance">
    <option value="Theft Case Investigation">
  </datalist>

  <!-- MOM Generation Modal -->
  <div id="momModal" class="mom-modal hidden">
    <div class="mom-modal-content">
      <span class="close-button" onclick="closeMomModal()">&times;</span>
      <div id="generatedMomOutput" class="mom-output">
        <!-- Generated MOM will be inserted here -->
      </div>
      <div class="mom-actions">
        <button class="btn" id="printMomBtn"><i class="fas fa-print"></i> Print</button>
        <button class="btn" id="copyMomBtn"><i class="fas fa-copy"></i> Copy to Clipboard</button>
      </div>
    </div>
  </div>

  <script>
    let currentStepIndex = 0; // Use currentStepIndex to avoid confusion with step numbers (1-based)
    const steps = document.querySelectorAll('.form-step');
    const tabsContainer = document.getElementById('tabsContainer');
    const addTaskBtn = document.getElementById('addTaskBtn');

    // Create tabs dynamically
    steps.forEach((step, index) => {
      const tab = document.createElement('div');
      tab.classList.add('tab');
      tab.dataset.stepIndex = index;

      const titleElement = document.createElement('div');
      titleElement.classList.add('tab-title');
      // Get title from the section-header h3 or infer from placeholder
      let headerText = '';
      const sectionHeaderH3 = step.querySelector('.section-header h3');
      if (sectionHeaderH3) {
          headerText = sectionHeaderH3.textContent;
      } else {
          // Fallback to placeholder if h3 is missing (though now all h3 should exist)
          const inputOrTextarea = step.querySelector('input, textarea');
          if (inputOrTextarea && inputOrTextarea.placeholder) {
              headerText = inputOrTextarea.placeholder.split(' & ')[0];
          } else {
              headerText = `Step ${index + 1}`;
          }
      }
      titleElement.textContent = headerText;

      const dataElement = document.createElement('div');
      dataElement.classList.add('tab-data');
      dataElement.id = `tabData${index}`; // Unique ID for updating data
      dataElement.textContent = 'Not entered'; // Default text

      tab.appendChild(titleElement);
      tab.appendChild(dataElement);
      tabsContainer.appendChild(tab);

      tab.addEventListener('click', () => activateTab(index));
    });

    const tabs = document.querySelectorAll('.tab');

    /**
     * Shows a specific form step and updates tab active state.
     * @param {number} stepIndex The 0-based index of the step to show.
     */
    function showStep(stepIndex) {
      steps.forEach((step, index) => {
        if (index === stepIndex) {
          step.classList.remove('hidden'); // Ensure it's not display: none
          setTimeout(() => { // Allow display change to register before animating
            step.classList.add('visible');
          }, 50);
        } else {
          step.classList.remove('visible');
          // Use a timeout to allow animation to complete before setting display: none
          setTimeout(() => {
            step.classList.add('hidden');
          }, 600); // Should match CSS transition duration
        }
      });

      tabs.forEach((tab, index) => {
        if (index === stepIndex) {
          tab.classList.add('active');
        } else {
          tab.classList.remove('active');
        }
      });

      currentStepIndex = stepIndex;
      updateAddButtonState(); // Update button state whenever step changes
    }

    /**
     * Activates a tab by showing its corresponding step.
     * @param {number} stepIndex The 0-based index of the tab/step to activate.
     */
    function activateTab(stepIndex) {
      showStep(stepIndex);
    }

    /**
     * Updates the state of the "Add Task" button based on whether any task is expanded.
     */
    function updateAddButtonState() {
        // Only relevant if we are on step 5 (Action Items)
        if (currentStepIndex === 4) { // currentStepIndex is 0-based for step 5
            const tasks = document.querySelectorAll('#tasksContainer .task-item');
            let anyTaskExpanded = false;
            tasks.forEach(task => {
                if (!task.classList.contains('collapsed')) {
                    anyTaskExpanded = true;
                }
            });

            if (anyTaskExpanded) {
                addTaskBtn.disabled = true;
            } else {
                addTaskBtn.disabled = false;
            }
        } else {
            // If not on step 5, ensure the button isn't accidentally disabled
            if (addTaskBtn) {
                addTaskBtn.disabled = false;
            }
        }
    }


    /**
     * Saves data for the current step and moves to the next.
     * @param {number} stepNumber The 1-based number of the current step.
     */
    function saveAndNext(stepNumber) {
      const stepIndex = stepNumber - 1; // Convert to 0-based index
      const tabDataElement = document.getElementById(`tabData${stepIndex}`);

      let dataSummary = '';
      // Populate tab data based on the current step
      if (stepNumber === 1) {
        dataSummary = document.getElementById('meetingName').value;
      } else if (stepNumber === 2) {
        const dateValue = document.getElementById('meetingDate').value;
        dataSummary = dateValue ? new Date(dateValue).toLocaleDateString() : 'Not entered';
      } else if (stepNumber === 3) {
        dataSummary = document.getElementById('meetingLocation').value;
      } else if (stepNumber === 4) {
        const attendees = Array.from(document.querySelectorAll('#attendeesContainer .attendee-tag')).map(tag => tag.firstChild.textContent.trim()).filter(Boolean);
        dataSummary = attendees.length > 0 ? `${attendees.length} Attendees` : 'No Attendees';
      } else if (stepNumber === 5) {
        const tasks = document.querySelectorAll('#tasksContainer > .form-group.task-item').length;
        dataSummary = tasks > 0 ? `${tasks} Action Items` : 'No Action Items';

        // Collapse all tasks in the Action Items container when moving to next step
        document.querySelectorAll('#tasksContainer .task-item').forEach(taskItem => {
            taskItem.classList.add('collapsed');
            const toggleBtnIcon = taskItem.querySelector('.toggle-btn i');
            if (toggleBtnIcon) {
                toggleBtnIcon.classList.remove('fa-chevron-up');
                toggleBtnIcon.classList.add('fa-chevron-down');
            }
        });
        updateAddButtonState(); // Update button state after collapsing all tasks

      } else if (stepNumber === 6) {
        const agendaText = document.getElementById('agenda').value;
        dataSummary = agendaText.substring(0, 30) + (agendaText.length > 30 ? '...' : '');
      } else if (stepNumber === 7) {
        const nextStepsText = document.getElementById('nextSteps').value;
        dataSummary = nextStepsText.substring(0, 30) + (nextStepsText.length > 30 ? '...' : '');
      }
      tabDataElement.textContent = dataSummary || 'Not entered'; // Show "Not entered" if empty

      if (stepIndex < steps.length - 1) { // If not the last step
        showStep(stepIndex + 1); // Show the next step
      } else {
        // This is the last step, the "Generate MOM" button will handle the final action
      }
    }

    /**
     * Adds a new attendee input field with tagging functionality.
     */
    function addAttendee() {
      const div = document.createElement('div');
      div.className = 'form-group';
      div.innerHTML = `
        <div class="attendees-input-area">
            <div class="attendees-tags-container"></div>
            <input type="text" class="attendee-input-field" placeholder="Add Attendee(s)" list="assignedToSuggestions">
        </div>
      `;
      document.getElementById('attendeesContainer').appendChild(div);

      const attendeeInputField = div.querySelector('.attendee-input-field');
      const attendeesTagsContainer = div.querySelector('.attendees-tags-container');

      /**
       * Adds an attendee tag to the container.
       * @param {string} attendeeName The name of the attendee to add.
       */
      const addAttendeeTag = (attendeeName) => {
        const trimmedName = attendeeName.trim();
        if (trimmedName && !Array.from(attendeesTagsContainer.children).some(tag => tag.firstChild.textContent.trim() === trimmedName)) {
          const tagSpan = document.createElement('span');
          tagSpan.className = 'attendee-tag';
          tagSpan.textContent = trimmedName;
          const removeBtn = document.createElement('button');
          removeBtn.className = 'attendee-remove-btn';
          removeBtn.textContent = 'x';
          removeBtn.onclick = () => tagSpan.remove();
          tagSpan.appendChild(removeBtn);
          attendeesTagsContainer.appendChild(tagSpan);
        }
      };

      // Event listeners for adding tags via Enter, Tab, or comma
      attendeeInputField.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === 'Tab' || e.key === ',') {
          e.preventDefault();
          if (attendeeInputField.value) {
            attendeeInputField.value.split(',').forEach(name => addAttendeeTag(name));
            attendeeInputField.value = '';
          }
        } else if (e.key === 'Backspace' && attendeeInputField.value === '') {
          const lastTag = attendeesTagsContainer.lastElementChild;
          if (lastTag) {
            lastTag.remove();
          }
        }
      });

      // Handle comma separated input as user types
      attendeeInputField.addEventListener('input', () => {
        if (attendeeInputField.value.includes(',')) {
          const parts = attendeeInputField.value.split(',');
          parts.slice(0, -1).forEach(name => addAttendeeTag(name));
          attendeeInputField.value = parts[parts.length - 1];
        }
      });
    }

    let taskCounter = 0; // To assign unique numbers to tasks

    /**
     * Adds a new task item with its input fields and tagging functionality.
     */
    function addTask() {
      taskCounter++;
      const taskId = `task-${taskCounter}`;

      const div = document.createElement('div');
      div.className = 'form-group task-item collapsed'; // Start collapsed, will expand immediately
      div.id = taskId; // Unique ID for this task
      div.innerHTML = `
        <div class="task-header">
            <h3>Task <span class="task-number">${taskCounter}</span>: <span class="task-summary">New Task</span></h3>
            <button class="toggle-btn"><i class="fas fa-chevron-down"></i></button>
        </div>
        <div class="task-details-content">
            <div class="assignees-input-area">
                <div class="assignees-tags-container"></div>
                <input type="text" class="assignee-input-field" placeholder="Assigned To" list="assignedToSuggestions">
            </div>
            <div class="autocomplete-wrapper">
                <input type="text" class="task-description-input" placeholder="Task Description" autocomplete="off" list="taskDescriptionSuggestions">
                <div class="autocomplete-suggestions"></div>
            </div>
            <select class="task-priority-select">
                <option disabled selected value="">Priority</option>
                <option value="low">Low</option>
                <option value="medium">Medium</option>
                <option value="high">High</option>
            </select>
            <input type="date" class="real-date-input" placeholder="Set target date">
            <select class="task-status-select">
                <option disabled selected value="">Status</option>
                <option value="pending">Pending</option>
                <option value="in-progress">In Progress</option>
                <option value="completed">Completed</option>
            </select>
            <button class="btn save-task-btn">Save This Task</button>
        </div>
      `;
      document.getElementById('tasksContainer').appendChild(div);

      // Get references to elements within the new task item
      const taskHeader = div.querySelector('.task-header');
      const toggleBtn = div.querySelector('.toggle-btn');
      const taskSummarySpan = div.querySelector('.task-summary');
      const assigneeInputField = div.querySelector('.assignee-input-field');
      const assigneesTagsContainer = div.querySelector('.assignees-tags-container');
      const taskDescriptionInput = div.querySelector('.task-description-input');
      const saveTaskBtn = div.querySelector('.save-task-btn');

      // Autocomplete for Task Description
      const taskDescriptionSuggestions = Array.from(document.getElementById('taskDescriptionSuggestions').options).map(option => option.value);
      const wrapper = taskDescriptionInput.closest('.autocomplete-wrapper');
      const suggestionBox = wrapper.querySelector('.autocomplete-suggestions');

      taskDescriptionInput.addEventListener('input', () => {
        const words = taskDescriptionInput.value.toLowerCase().split(/\s+/);
        const currentWord = words[words.length - 1];
        suggestionBox.innerHTML = '';

        if (currentWord.trim() === '') {
          suggestionBox.style.display = 'none';
          return;
        }

        const matches = taskDescriptionSuggestions.filter(s => s.toLowerCase().includes(currentWord));
        if (matches.length === 0) {
          suggestionBox.style.display = 'none';
          return;
        }

        matches.forEach(match => {
          const suggestionDiv = document.createElement('div');
          suggestionDiv.textContent = match;
          suggestionDiv.onclick = () => {
            words[words.length - 1] = match;
            taskDescriptionInput.value = words.join(' ');
            suggestionBox.innerHTML = '';
            suggestionBox.style.display = 'none';
            taskDescriptionInput.dispatchEvent(new Event('input')); // Trigger input event to update summary
          };
          suggestionBox.appendChild(suggestionDiv);
        });
        suggestionBox.style.display = 'block';
      });

      // Hide suggestions when clicking outside
      document.addEventListener('click', (e) => {
        if (!wrapper.contains(e.target)) {
          suggestionBox.style.display = 'none';
        }
      });

      // Toggle functionality for the task header
      taskHeader.addEventListener('click', () => {
        div.classList.toggle('collapsed');
        toggleBtn.querySelector('i').classList.toggle('fa-chevron-down');
        toggleBtn.querySelector('i').classList.toggle('fa-chevron-up');
        updateAddButtonState(); // Update button state on toggle
      });

      // Initially expand the newly added task
      setTimeout(() => {
        div.classList.remove('collapsed');
        toggleBtn.querySelector('i').classList.add('fa-chevron-up');
        toggleBtn.querySelector('i').classList.remove('fa-chevron-down');
        updateAddButtonState(); // Update button state after initial expand
      }, 100);

      /**
       * Updates the summary text in the task header.
       */
      const updateTaskSummary = () => {
        const description = taskDescriptionInput.value.trim();
        const assignees = Array.from(assigneesTagsContainer.querySelectorAll('.assignee-tag')).map(tag => tag.firstChild.textContent.trim()).join(', ');
        if (description || assignees) {
          taskSummarySpan.textContent = `${description || 'No Description'} ${assignees ? `(${assignees})` : ''}`;
        } else {
          taskSummarySpan.textContent = 'New Task';
        }
      };

      // Event listeners for updating summary
      taskDescriptionInput.addEventListener('input', updateTaskSummary);

      // Save Task Button functionality
      saveTaskBtn.addEventListener('click', () => {
          div.classList.add('collapsed');
          toggleBtn.querySelector('i').classList.remove('fa-chevron-up');
          toggleBtn.querySelector('i').classList.add('fa-chevron-down');
          updateTaskSummary(); // Ensure summary is up-to-date
          updateAddButtonState(); // Update button state after saving/collapsing this task
      });


      // --- Assignee Tagging Logic ---
      const addAssigneeTag = (assigneeName) => {
        const trimmedName = assigneeName.trim();
        if (trimmedName && !Array.from(assigneesTagsContainer.children).some(tag => tag.firstChild.textContent.trim() === trimmedName)) {
          const tagSpan = document.createElement('span');
          tagSpan.className = 'assignee-tag';
          tagSpan.textContent = trimmedName;
          const removeBtn = document.createElement('button');
          removeBtn.className = 'assignee-remove-btn';
          removeBtn.textContent = 'x';
          removeBtn.onclick = () => {
            tagSpan.remove();
            updateTaskSummary(); // Update summary when tag is removed
          };
          tagSpan.appendChild(removeBtn);
          assigneesTagsContainer.appendChild(tagSpan);
          updateTaskSummary(); // Update summary when tag is added
        }
      };

      assigneeInputField.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === 'Tab' || e.key === ',') {
          e.preventDefault();
          if (assigneeInputField.value) {
            assigneeInputField.value.split(',').forEach(name => addAssigneeTag(name));
            assigneeInputField.value = '';
          }
        } else if (e.key === 'Backspace' && assigneeInputField.value === '') {
          const lastTag = assigneesTagsContainer.lastElementChild;
          if (lastTag) {
            lastTag.remove();
            updateTaskSummary(); // Update summary when tag is removed
          }
        }
      });

      assigneeInputField.addEventListener('input', () => {
        if (assigneeInputField.value.includes(',')) {
          const parts = assigneeInputField.value.split(',');
          parts.slice(0, -1).forEach(name => addAssigneeTag(name));
          assigneeInputField.value = parts[parts.length - 1];
        }
        updateTaskSummary(); // Also update summary as user types in the input field
      });
      // --- End Assignee Tagging Logic ---
    }


    /**
     * Generates the Minutes of Meeting (MOM) document from the collected form data
     * and displays it in a modal.
     */
    function generateMOM() {
      const meetingName = document.getElementById('meetingName').value || 'Untitled Meeting';
      const meetingDate = document.getElementById('meetingDate').value;
      const meetingLocation = document.getElementById('meetingLocation').value || 'Not Specified';
      const agenda = document.getElementById('agenda').value || 'No specific agenda points were noted.';
      const nextSteps = document.getElementById('nextSteps').value || 'No additional next steps or discussions.';

      // Collect Attendees
      const attendees = Array.from(document.querySelectorAll('#attendeesContainer .attendee-tag')).map(tag => tag.firstChild.textContent.trim()).filter(Boolean);
      let attendeesHtml = '';
if (attendees.length > 0) {
  attendeesHtml = `
    <p><strong>Attendees:</strong> ${attendees.join(', ')}</p>
  `;
}
 else {
        attendeesHtml = `<p><strong>Attendees:</strong> No attendees listed.</p>`;
      }

      // Collect Action Items
      const tasks = [];
      document.querySelectorAll('#tasksContainer .task-item').forEach(taskItem => {
        const taskDescriptionInput = taskItem.querySelector('.task-description-input');
        const taskPrioritySelect = taskItem.querySelector('.task-priority-select');
        const realDateInput = taskItem.querySelector('.real-date-input');
        const taskStatusSelect = taskItem.querySelector('.task-status-select');

        const assignees = Array.from(taskItem.querySelectorAll('.assignee-tag')).map(tag => tag.firstChild.textContent.trim()).filter(Boolean);

        tasks.push({
          description: taskDescriptionInput ? taskDescriptionInput.value.trim() : 'N/A',
          assignees: assignees.length > 0 ? assignees.join(', ') : 'N/A',
          priority: taskPrioritySelect && taskPrioritySelect.value ? taskPrioritySelect.value.charAt(0).toUpperCase() + taskPrioritySelect.value.slice(1) : 'N/A',
          targetDate: realDateInput && realDateInput.value ? realDateInput.value : 'N/A',
          status: taskStatusSelect && taskStatusSelect.value ? taskStatusSelect.value.charAt(0).toUpperCase() + taskStatusSelect.value.slice(1) : 'N/A'
        });
      });

      let tasksHtml = '';
      if (tasks.length > 0) {
        tasksHtml = `
          <h3>Action Items:</h3>
          <ol>
            ${tasks.map((task, index) => `
              <li>
                ${task.description}
                <span class="action-item-details">
                  Assigned To: <i>${task.assignees}</i> |
                  Priority: <i>${task.priority}</i> |
                  Target Date: <i>${task.targetDate}</i> |
                  Status: <i>${task.status}</i>
                </span>
              </li>
            `).join('')}
          </ol>
        `;
      } else {
        tasksHtml = `<p><strong>Action Items:</strong> No action items were assigned.</p>`;
      }

      // Format date for display
      const displayDate = meetingDate ? new Date(meetingDate).toLocaleString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      }) : 'Not Specified';


      const momContent = `
        <div class="mom-document">
          <h2>Minutes of Meeting</h2>
          <div class="mom-section">
            <h3>Meeting Details:</h3>
            <p><strong>Title:</strong> ${meetingName}</p>
            <p><strong>Date & Time:</strong> ${displayDate}</p>
            <p><strong>Location:</strong> ${meetingLocation}</p>
          </div>

          <div class="mom-section">
            ${attendeesHtml}
          </div>

          <div class="mom-section">
            <h3>Agenda:</h3>
            <p>${agenda.replace(/\n/g, '<br>')}</p>
          </div>

          <div class="mom-section">
            ${tasksHtml}
          </div>

          <div class="mom-section">
            <h3>Next Steps / Other Discussions:</h3>
            <p>${nextSteps.replace(/\n/g, '<br>')}</p>
          </div>
        </div>
      `;

      document.getElementById('generatedMomOutput').innerHTML = momContent;
      document.getElementById('momModal').classList.remove('hidden');

      // Add event listeners for print and copy buttons
      document.getElementById('printMomBtn').onclick = printMom;
      document.getElementById('copyMomBtn').onclick = copyMomToClipboard;
    }

    /**
     * Closes the MOM display modal.
     */
    function closeMomModal() {
      document.getElementById('momModal').classList.add('hidden');
    }

    /**
     * Triggers the browser's print functionality for the MOM content.
     */
    function printMom() {
      window.print();
    }

    /**
     * Copies the generated MOM content to the clipboard.
     */
    function copyMomToClipboard() {
      const momOutput = document.getElementById('generatedMomOutput');
      const range = document.createRange();
      range.selectNode(momOutput);
      window.getSelection().removeAllRanges();
      window.getSelection().addRange(range);
      try {
        const successful = document.execCommand('copy');
        const msg = successful ? 'MOM copied to clipboard successfully!' : 'Failed to copy MOM.';
        alertMessage(msg); // Use a custom alert message function
      } catch (err) {
        alertMessage('Oops, unable to copy: ' + err);
      }
      window.getSelection().removeAllRanges();
    }

    /**
     * Displays a custom alert message temporarily.
     * @param {string} message The message to display.
     */
    function alertMessage(message) {
      let msgBox = document.getElementById('customMessageBox');
      if (!msgBox) {
        msgBox = document.createElement('div');
        msgBox.id = 'customMessageBox';
        document.body.appendChild(msgBox);
      }
      msgBox.textContent = message;
      msgBox.style.opacity = 1;

      setTimeout(() => {
        msgBox.style.opacity = 0;
        setTimeout(() => {
          if (msgBox && msgBox.parentNode) { // Check if it still exists before trying to remove
            msgBox.remove();
          }
        }, 300); // Match CSS transition duration
      }, 3000); // Display for 3 seconds
    }


    // Initial setup on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
      // Set the default date and time to the current date and time
      const now = new Date();
      now.setMinutes(now.getMinutes() - now.getTimezoneOffset()); // Adjust for timezone
      document.getElementById('meetingDate').value = now.toISOString().slice(0, 16);

      // Initially hide all steps and then show the first one
      steps.forEach(step => step.classList.add('hidden'));
      showStep(0); // Show the first step on load
      addAttendee(); // Add one attendee input by default with the new tag functionality
      addTask();     // Add one task input by default

      // Update initial tab data for the first step
      document.getElementById('tabData0').textContent = document.getElementById('meetingName').value || 'Not entered';
      updateAddButtonState(); // Set initial state of Add Task button
    });

    // Global suggestions for agenda and next steps textareas
    const globalSuggestions = [
      "Review of last meeting's assignments",
      "Discussion on project progress",
      "Brainstorming new ideas for marketing campaign",
      "Budget review and allocation",
      "Client feedback and next steps",
      "Team performance evaluation",
      "Planning for upcoming events",
      "Addressing operational challenges",
      "Disconnection Drive",
      "OSD Collection",
      "Revenue Collection",
      "S&LP Cases Review",
      "Court Cases Status",
      "AT&C Loss Analysis",
      "T&D Loss Reduction",
      "Demand Side Management",
      "Collection Performance",
      "Input Energy Audit",
      "Physical Disconnection Enforcement",
      "New Service Connections Processing",
      "Accident Report Preparation",
      "Bulk Connection Survey",
      "Priority SI Works Status",
      "Long Pending NSC Clearance",
      "Commercial Consumer Review",
      "Industrial Consumer Review",
      "Agriculture Feeder Monitoring",
      "STW Compliance",
      "Theft Case Investigation"
    ];

    // Enable autocomplete for both agenda and nextSteps textareas
    ["agenda", "nextSteps"].forEach(id => {
      const textarea = document.getElementById(id);
      const wrapper = textarea.closest('.autocomplete-wrapper');
      const suggestionBox = wrapper.querySelector('.autocomplete-suggestions');

      textarea.addEventListener('input', () => {
        const words = textarea.value.toLowerCase().split(/\s+/);
        const currentWord = words[words.length - 1];
        suggestionBox.innerHTML = '';

        if (currentWord.trim() === '') {
          suggestionBox.style.display = 'none';
          return;
        }

        const matches = globalSuggestions.filter(s => s.toLowerCase().includes(currentWord));
        if (matches.length === 0) {
          suggestionBox.style.display = 'none';
          return;
        }

        matches.forEach(match => {
          const div = document.createElement('div');
          div.textContent = match;
          div.onclick = () => {
            words[words.length - 1] = match;
            textarea.value = words.join(' ');
            suggestionBox.innerHTML = '';
            suggestionBox.style.display = 'none';
            textarea.dispatchEvent(new Event('input')); // Trigger input event to update tab summary
          };
          suggestionBox.appendChild(div);
        });
        suggestionBox.style.display = 'block';
      });

      document.addEventListener('click', (e) => {
        if (!wrapper.contains(e.target)) {
          suggestionBox.style.display = 'none';
        }
      });
    });

  </script>

</body>
</html>
