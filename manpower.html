<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Authentication Styles */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .auth-card {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 400px;
            text-align: center;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .auth-header {
            margin-bottom: 30px;
        }

        .auth-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .auth-header p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .pin-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 18px;
            text-align: center;
            letter-spacing: 3px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .pin-input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .auth-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .auth-btn:hover:not(:disabled) {
            background: #45a049;
            transform: translateY(-2px);
        }

        .auth-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #c62828;
            text-align: left;
        }

        .loading-message {
            color: #666;
            margin-top: 15px;
            font-style: italic;
        }

        /* Dashboard Styles - Hidden initially */
        .dashboard {
            display: none;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .search-section {
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
        }

        .search-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #4CAF50, #2196F3, #FF9800);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 16px 40px rgba(0, 0, 0, 0.15);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            color: #7f8c8d;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2rem;
            opacity: 0.3;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-weight: 300;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .close:hover {
            opacity: 0.7;
        }

        .modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .search-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .search-results {
            max-height: 300px;
            overflow-y: auto;
        }

        .employee-item {
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
            background: #f9f9f9;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .employee-item:hover {
            background: #f0f0f0;
            border-color: #4CAF50;
        }

        .employee-info h4 {
            margin: 0 0 5px 0;
            color: #2c3e50;
        }

        .employee-info p {
            margin: 0;
            color: #7f8c8d;
            font-size: 14px;
        }

        .detail-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .detail-btn:hover {
            background: #1976D2;
        }

        .detail-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .detail-table th,
        .detail-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .detail-table th {
            background: #f5f5f5;
            font-weight: 600;
            color: #2c3e50;
        }

        .detail-table tr:hover {
            background: #f9f9f9;
        }

        .no-results {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-style: italic;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .auth-card {
                padding: 30px 20px;
            }

            .auth-header h1 {
                font-size: 2rem;
            }

            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .modal-content {
                width: 95%;
                margin: 2% auto;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication Screen -->
    <div id="authScreen" class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <h1>🔐</h1>
                <p>Please enter your PIN to access the Employee Dashboard</p>
            </div>
            <div>
                <input type="password" class="pin-input" id="pinInput" 
                       placeholder="Enter PIN..." 
                       onkeypress="handlePinKeyPress(event)"
                       maxlength="10">
                <button class="auth-btn" id="authBtn" onclick="validatePin()">
                    <span id="authBtnText">🔓 Authenticate</span>
                </button>
                <div id="authError" class="error-message" style="display: none;"></div>
                <div id="authLoading" class="loading-message" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Dashboard Content - Hidden until authenticated -->
    <div id="dashboardContent" class="dashboard">
        <div class="container">
            <div class="header">
                <h1>Employee Dashboard</h1>
                
            </div>

            <div class="search-section">
                <button class="search-btn" onclick="openSearchModal()">
                    🔍 Search Employee
                </button>
            </div>

<div class="stats-grid">
  <div class="stat-card" onclick="openDesignationModal()">
    <div class="stat-icon">👥</div>
    <div class="stat-number" id="totalEmployees">-</div>
    <div class="stat-label">Total Employees</div>
  </div>
  <div class="stat-card" onclick="openProfitCenterModal()">
    <div class="stat-icon">🏢</div>
    <div class="stat-number" id="profitCenters">-</div>
    <div class="stat-label">Profit Centers</div>
  </div>
  <div class="stat-card" onclick="openCostCenterModal()">
    <div class="stat-icon">🎯</div>
    <div class="stat-number" id="costCenters">-</div>
    <div class="stat-label">Cost Centers</div>
  </div>
</div>

        </div>

        <!-- Search Modal -->
        <div id="searchModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Search Employee</h2>
                    <span class="close" onclick="closeSearchModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <input type="text" class="search-input" id="searchInput" 
                           placeholder="Enter employee name or employee number..." 
                           oninput="searchEmployees()">
                    <div id="searchResults" class="search-results"></div>
                </div>
            </div>
        </div>

        <!-- Detail Modal -->
        <div id="detailModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Employee Details</h2>
                    <span class="close" onclick="closeDetailModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <div id="employeeDetails"></div>
                </div>
            </div>
        </div>
    </div>

<!-- Designation Modal -->
<div id="designationModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Designation-wise Count</h2>
      <span class="close" onclick="closeDesignationModal()">&times;</span>
    </div>
    <div class="modal-body" id="designationList"></div>
  </div>
</div>

<!-- Employee List Modal -->
<div id="employeeListModal" class="modal" style="z-index: 1100;">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Employee List</h2>
      <span class="close" onclick="closeEmployeeListModal()">&times;</span>
    </div>
    <div class="modal-body" id="employeeListBody"></div>
  </div>
</div>
<!-- Profit Center Modal -->
<div id="profitCenterModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Profit Center-wise Summary</h2>
      <span class="close" onclick="closeProfitCenterModal()">&times;</span>
    </div>
    <div class="modal-body" id="profitCenterList"></div>
  </div>
</div>

<!-- Cost Center Modal -->
<div id="costCenterModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Cost Center-wise Summary</h2>
      <span class="close" onclick="closeCostCenterModal()">&times;</span>
    </div>
    <div class="modal-body" id="costCenterList"></div>
  </div>
</div>


    <script>
        let employeeData = [];
        let authorizedPins = [];
        let isDataLoaded = false;
        let isAuthenticated = false;

        // Load PIN data on page load
        window.addEventListener('DOMContentLoaded', function() {
            loadAuthorizedPins();
        });

        async function loadAuthorizedPins() {
            // Load PINs from Sheet2, Column B
            // Note: You may need to adjust the gid parameter for Sheet2
            const pinUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRRXojudL5q-ln7pXOcbLaGsBqznppnvsINcp8xEFvpJUWRCiC7bjii9eZYSu0istzyM91m4yybd5g-/pub?gid=2073511562&single=true&output=csv';
            
            try {
                showAuthLoading('Loading authorization data...');
                const response = await fetch(pinUrl);
                const csvText = await response.text();
                
                Papa.parse(csvText, {
                    header: false,
                    dynamicTyping: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        // Extract Column B (index 1) values, skipping header row
                        authorizedPins = results.data.slice(1).map(row => {
                            return row[1] ? row[1].toString().trim() : null;
                        }).filter(pin => pin && pin !== '');
                        
                        hideAuthLoading();
                        console.log('Loaded authorized PINs');
                        
                        // Focus on PIN input
                        document.getElementById('pinInput').focus();
                    },
                    error: function(error) {
                        console.error('Error loading PINs:', error);
                        showAuthError('Failed to load authorization data. Please refresh the page.');
                        hideAuthLoading();
                    }
                });
            } catch (error) {
                console.error('Error fetching PIN data:', error);
                showAuthError('Failed to connect to authorization server. Please check your internet connection.');
                hideAuthLoading();
            }
        }

        function handlePinKeyPress(event) {
            if (event.key === 'Enter') {
                validatePin();
            }
        }

        async function validatePin() {
            const pinInput = document.getElementById('pinInput');
            const enteredPin = pinInput.value.trim();
            
            if (!enteredPin) {
                showAuthError('Please enter a PIN.');
                return;
            }

            if (authorizedPins.length === 0) {
                showAuthError('Authorization data not loaded. Please refresh the page.');
                return;
            }

            showAuthLoading('Validating PIN...');
            disableAuthButton(true);
            
            // Small delay to show loading state
            setTimeout(() => {
                if (authorizedPins.includes(enteredPin)) {
                    // PIN is valid - authenticate user and load dashboard
                    isAuthenticated = true;
                    showAuthLoading('Access granted! Loading dashboard...');
                    
                    setTimeout(() => {
                        document.getElementById('authScreen').style.display = 'none';
                        document.getElementById('dashboardContent').style.display = 'block';
                        loadEmployeeData();
                    }, 1000);
                } else {
                    // PIN is invalid
                    showAuthError('Ask admin to authorize you.');
                    pinInput.value = '';
                    pinInput.focus();
                    hideAuthLoading();
                    disableAuthButton(false);
                }
            }, 1500);
        }

        function showAuthError(message) {
            const errorDiv = document.getElementById('authError');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        function showAuthLoading(message) {
            const loadingDiv = document.getElementById('authLoading');
            loadingDiv.textContent = message;
            loadingDiv.style.display = 'block';
        }

        function hideAuthLoading() {
            document.getElementById('authLoading').style.display = 'none';
        }

        function disableAuthButton(disabled) {
            const authBtn = document.getElementById('authBtn');
            authBtn.disabled = disabled;
            document.getElementById('authBtnText').textContent = disabled ? '⏳ Validating...' : '🔓 Authenticate';
        }

        async function loadEmployeeData() {
            const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRRXojudL5q-ln7pXOcbLaGsBqznppnvsINcp8xEFvpJUWRCiC7bjii9eZYSu0istzyM91m4yybd5g-/pub?gid=2110628491&single=true&output=csv';
            
            try {
                showLoading();
                const response = await fetch(csvUrl);
                const csvText = await response.text();
                
                Papa.parse(csvText, {
                    header: true,
                    dynamicTyping: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        // Clean headers by removing whitespace
                        employeeData = results.data.map(row => {
                            const cleanRow = {};
                            Object.keys(row).forEach(key => {
                                const cleanKey = key.trim();
                                cleanRow[cleanKey] = row[key];
                            });
                            return cleanRow;
                        }).filter(row => row.Name && row.Name.trim() !== '');
                        
                        updateStats();
                        isDataLoaded = true;
                        hideLoading();
                    },
                    error: function(error) {
                        console.error('Error parsing CSV:', error);
                        showError('Failed to load employee data. Please try again.');
                    }
                });
            } catch (error) {
                console.error('Error fetching data:', error);
                showError('Failed to fetch employee data. Please check your internet connection.');
            }
        }

        function updateStats() {
            const totalEmployees = employeeData.length;
            const profitCenters = new Set(employeeData.map(emp => emp['Profit Center Code']).filter(code => code)).size;
            const costCenters = new Set(employeeData.map(emp => emp['Cost Center Code']).filter(code => code)).size;

            document.getElementById('totalEmployees').textContent = totalEmployees;
            document.getElementById('profitCenters').textContent = profitCenters;
            document.getElementById('costCenters').textContent = costCenters;
        }

        function showLoading() {
            document.getElementById('totalEmployees').textContent = '...';
            document.getElementById('profitCenters').textContent = '...';
            document.getElementById('costCenters').textContent = '...';
        }

        function hideLoading() {
            // Stats are updated in updateStats()
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            document.querySelector('.container').insertBefore(errorDiv, document.querySelector('.search-section'));
        }

        function openSearchModal() {
            if (!isDataLoaded) {
                alert('Employee data is still loading. Please wait a moment.');
                return;
            }
            document.getElementById('searchModal').style.display = 'block';
            document.getElementById('searchInput').focus();
        }

        function closeSearchModal() {
            document.getElementById('searchModal').style.display = 'none';
            document.getElementById('searchInput').value = '';
            document.getElementById('searchResults').innerHTML = '';
        }

        function closeDetailModal() {
            document.getElementById('detailModal').style.display = 'none';
        }

        function searchEmployees() {
            const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            const resultsDiv = document.getElementById('searchResults');

            if (searchTerm === '') {
                resultsDiv.innerHTML = '';
                return;
            }

            const filteredEmployees = employeeData.filter(employee => {
                const name = (employee.Name || '').toString().toLowerCase();
                const empNo = (employee['Employee No'] || '').toString().toLowerCase();
                return name.includes(searchTerm) || empNo.includes(searchTerm);
            });

            if (filteredEmployees.length === 0) {
                resultsDiv.innerHTML = '<div class="no-results">No employees found matching your search.</div>';
                return;
            }

            let html = '';
            filteredEmployees.forEach((employee, index) => {
                html += `
                    <div class="employee-item">
                        <div class="employee-info">
                            <h4>${employee.Name || 'N/A'}</h4>
                            <p>Employee No: ${employee['Employee No'] || 'N/A'} | ${employee.Designation || 'N/A'}</p>
                        </div>
                        <button class="detail-btn" onclick="showEmployeeDetails(${employeeData.indexOf(employee)})">
                            Show Details
                        </button>
                    </div>
                `;
            });

            resultsDiv.innerHTML = html;
        }

        function showEmployeeDetails(index) {
            const employee = employeeData[index];
            const detailsDiv = document.getElementById('employeeDetails');

            let html = '<table class="detail-table">';
            
            const fieldsToShow = [
                'Employee No', 'Name', 'Profit Center Code', 'Profit Center Name',
                'Cost Center Code', 'Cost Center Name', 'Legacy ID', 'Position',
                'Designation', 'Class', 'Date of joining', 'Date of Retirement',
                'Date of Increment', 'IFSC Code', 'Bank Account No', 'Payscale Group',
                'Payscale Level', 'Pay', 'Grade Pay', 'Dearness Allowance',
                'House Rent Allowance', 'Gross Salary', 'PF A/C Number',
                'PF Trust ID', 'Lock Status'
            ];

            fieldsToShow.forEach(field => {
                const value = employee[field] || 'N/A';
                html += `
                    <tr>
                        <th>${field}</th>
                        <td>${value}</td>
                    </tr>
                `;
            });

            html += '</table>';
            detailsDiv.innerHTML = html;

            closeSearchModal();
            document.getElementById('detailModal').style.display = 'block';
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const searchModal = document.getElementById('searchModal');
            const detailModal = document.getElementById('detailModal');
            
            if (event.target === searchModal) {
                closeSearchModal();
            }
            if (event.target === detailModal) {
                closeDetailModal();
            }
            if (event.target === document.getElementById('designationModal')) {
  closeDesignationModal();
}
if (event.target === document.getElementById('employeeListModal')) {
  closeEmployeeListModal();
}
if (event.target === document.getElementById('profitCenterModal')) {
  closeProfitCenterModal();
}
if (event.target === document.getElementById('costCenterModal')) {
  closeCostCenterModal();
}

        }

function openDesignationModal() {
  if (!isDataLoaded) return alert("Data is still loading...");

  const designationMap = {};

  // Group by designation, track highest salary in each group
  employeeData.forEach(emp => {
    const desig = emp.Designation || "Unknown";
    const gross = parseFloat(emp['Gross Salary']) || 0;

    if (!designationMap[desig]) {
      designationMap[desig] = {
        count: 1,
        topSalary: gross
      };
    } else {
      designationMap[desig].count += 1;
      if (gross > designationMap[desig].topSalary) {
        designationMap[desig].topSalary = gross;
      }
    }
  });

  // Sort by top salary within each designation
  const sorted = Object.entries(designationMap).sort((a, b) => {
    return b[1].topSalary - a[1].topSalary;
  });

  const container = document.getElementById('designationList');
  container.innerHTML = '';

  sorted.forEach(([desig, data]) => {
    const div = document.createElement('div');
    div.className = 'employee-item';
    div.innerHTML = `
      <div class="employee-info">
        <h4>${desig}</h4>
        <p>${data.count} employees</p>
      </div>
      <button class="detail-btn" onclick="openEmployeeList('${desig.replace(/'/g, "\\'")}')">View</button>
    `;
    container.appendChild(div);
  });

  document.getElementById('designationModal').style.display = 'block';
}



function openProfitCenterModal() {
  if (!isDataLoaded) return alert("Data is still loading...");

  const map = {};

  employeeData.forEach(emp => {
    const code = emp['Profit Center Code'] || 'Unknown';
    const name = emp['Profit Center Name'] || 'Unnamed';
    const gross = parseFloat(emp['Gross Salary']) || 0;

    if (!map[code]) {
      map[code] = { name, count: 1, topSalary: gross };
    } else {
      map[code].count++;
      map[code].topSalary = Math.max(map[code].topSalary, gross);
    }
  });

const sorted = Object.entries(map).sort((a, b) => b[1].count - a[1].count);
  const container = document.getElementById('profitCenterList');
  container.innerHTML = '';

  sorted.forEach(([code, data]) => {
    const div = document.createElement('div');
    div.className = 'employee-item';
    div.innerHTML = `
      <div class="employee-info">
        <h4>${data.name} (${code})</h4>
        <p>${data.count} employees</p>
      </div>
      <button class="detail-btn" onclick="openGroupEmployeeList('Profit Center Code', '${code.replace(/'/g, "\\'")}')">View</button>
    `;
    container.appendChild(div);
  });

  document.getElementById('profitCenterModal').style.display = 'block';
}

function openCostCenterModal() {
  if (!isDataLoaded) return alert("Data is still loading...");

  const map = {};

  employeeData.forEach(emp => {
    const code = emp['Cost Center Code'] || 'Unknown';
    const name = emp['Cost Center Name'] || 'Unnamed';
    const gross = parseFloat(emp['Gross Salary']) || 0;

    if (!map[code]) {
      map[code] = { name, count: 1, topSalary: gross };
    } else {
      map[code].count++;
      map[code].topSalary = Math.max(map[code].topSalary, gross);
    }
  });

const sorted = Object.entries(map).sort((a, b) => b[1].count - a[1].count);
  const container = document.getElementById('costCenterList');
  container.innerHTML = '';

  sorted.forEach(([code, data]) => {
    const div = document.createElement('div');
    div.className = 'employee-item';
    div.innerHTML = `
      <div class="employee-info">
        <h4>${data.name} (${code})</h4>
        <p>${data.count} employees</p>
      </div>
      <button class="detail-btn" onclick="openGroupEmployeeList('Cost Center Code', '${code.replace(/'/g, "\\'")}')">View</button>
    `;
    container.appendChild(div);
  });

  document.getElementById('costCenterModal').style.display = 'block';
}

function openGroupEmployeeList(fieldName, value) {
  const list = employeeData
    .filter(emp => (emp[fieldName] || '') === value)
.sort((a, b) => {
  const placeA = (a['Cost Center Name'] || '').toLowerCase();
  const placeB = (b['Cost Center Name'] || '').toLowerCase();
  return placeA.localeCompare(placeB);
});

  const container = document.getElementById('employeeListBody');

  if (list.length === 0) {
    container.innerHTML = '<p class="no-results">No employees found.</p>';
  } else {
    let html = '<table class="detail-table"><tr><th>Name</th><th>Employee No</th><th>Place of Posting</th></tr>';
    list.forEach(emp => {
      html += `
        <tr>
          <td>${emp.Name || 'N/A'}</td>
          <td>${emp['Employee No'] || 'N/A'}</td>
          <td>${emp['Cost Center Name'] || 'N/A'}</td>
        </tr>
      `;
    });
    html += '</table>';
    container.innerHTML = html;
  }

  document.getElementById('employeeListModal').style.display = 'block';
}

function closeProfitCenterModal() {
  document.getElementById('profitCenterModal').style.display = 'none';
}

function closeCostCenterModal() {
  document.getElementById('costCenterModal').style.display = 'none';
}


function closeDesignationModal() {
  document.getElementById('designationModal').style.display = 'none';
}

function openEmployeeList(designation) {
const list = employeeData
  .filter(emp => (emp.Designation || '') === designation)
.sort((a, b) => {
  const placeA = (a['Cost Center Name'] || '').toLowerCase();
  const placeB = (b['Cost Center Name'] || '').toLowerCase();
  return placeA.localeCompare(placeB);
});

  const container = document.getElementById('employeeListBody');
  
  if (list.length === 0) {
    container.innerHTML = '<p class="no-results">No employees found.</p>';
  } else {
    let html = '<table class="detail-table"><tr><th>Name</th><th>Employee No</th><th>Place of Posting</th></tr>';
    list.forEach(emp => {
      html += `
        <tr>
          <td>${emp.Name || 'N/A'}</td>
          <td>${emp['Employee No'] || 'N/A'}</td>
          <td>${emp['Cost Center Name'] || 'N/A'}</td>
        </tr>
      `;
    });
    html += '</table>';
    container.innerHTML = html;
  }

  document.getElementById('employeeListModal').style.display = 'block';
}

function closeEmployeeListModal() {
  document.getElementById('employeeListModal').style.display = 'none';
}

    </script>
</body>
</html>
